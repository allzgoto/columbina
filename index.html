<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Dottore</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet" />

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
  background:black;
  overflow:hidden;
  font-family:'Orbitron', sans-serif;
  color:white;
}

/* ========= VIDEO LAYERS ========= */
#videoBlur{
  position:fixed;
  inset:-20%;
  width:140%;
  height:140%;
  object-fit:cover;
  filter: blur(var(--blur-amount, 90px)) brightness(.5) saturate(1.5);
  will-change: transform, filter;
  transform: translateZ(0);
  z-index:-5;
}
#video{
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  object-fit:contain;
  z-index:-4;
  background:black;

  -webkit-mask-image: linear-gradient(to right, transparent 0%, black 8%, black 92%, transparent 100%);
  mask-image: linear-gradient(to right, transparent 0%, black 8%, black 92%, transparent 100%);
}

/* ========= FX OVERLAYS ========= */
.scanlines{
  position:fixed;
  inset:0;
  background:repeating-linear-gradient(
    to bottom,
    rgba(255,255,255,0.03),
    rgba(255,255,255,0.03) 1px,
    transparent 1px,
    transparent 3px
  );
  pointer-events:none;
  z-index:3;
  mix-blend-mode:overlay;
  opacity:.75;
}

/* Grain + vinheta */
#cinemaFX{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:4;
}
#cinemaFX::before{
  content:"";
  position:absolute;
  inset:-20%;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
  opacity:.08;
  mix-blend-mode:overlay;
  transform: translateZ(0);
  animation:grain 5s steps(10) infinite;
}
#cinemaFX::after{
  content:"";
  position:absolute;
  inset:0;
  background:
    radial-gradient(circle at 50% 45%, transparent 0 55%, rgba(0,0,0,.55) 78%, rgba(0,0,0,.85) 100%),
    linear-gradient(90deg, rgba(0,200,255,.05), transparent 35%, transparent 65%, rgba(0,200,255,.04));
  opacity:.65;
}
@keyframes grain{
  0%{transform:translate(0,0)}
  10%{transform:translate(-2%, -3%)}
  20%{transform:translate(-4%, 2%)}
  30%{transform:translate(3%, -2%)}
  40%{transform:translate(2%, 4%)}
  50%{transform:translate(-3%, 2%)}
  60%{transform:translate(4%, 0%)}
  70%{transform:translate(0%, 3%)}
  80%{transform:translate(-2%, -2%)}
  90%{transform:translate(3%, 1%)}
  100%{transform:translate(0,0)}
}

/* Glitch flash (só na entrada) */
#glitchFlash{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:9;
  opacity:0;
  background:
    linear-gradient(90deg, rgba(0,200,255,.12), transparent 35%, rgba(255,90,90,.08)),
    repeating-linear-gradient(0deg, rgba(255,255,255,.06) 0 1px, transparent 1px 4px);
  mix-blend-mode:screen;
}
.glitch-on #glitchFlash{ animation:glitchFlash .55s steps(6) 1; }
@keyframes glitchFlash{
  0%{opacity:0}
  10%{opacity:1; transform:translateX(8px)}
  25%{opacity:.35; transform:translateX(-10px)}
  40%{opacity:1; transform:translateX(6px)}
  60%{opacity:.2; transform:translateX(-5px)}
  80%{opacity:.9; transform:translateX(2px)}
  100%{opacity:0; transform:none}
}

/* ===== Sub-layer glitch (HUD/scanlines only, never center) ===== */
body.subglitch .scanlines{
  opacity:.95;
  filter: hue-rotate(8deg) contrast(1.15);
}
body.subglitch #coordsHUD,
body.subglitch #techHUD,
body.subglitch #statusStrip{
  filter: blur(.25px) saturate(1.15) contrast(1.08);
  opacity:.55;
  transform: translateX(.5px);
}

/* ========= LOADING ========= */
#loadingScreen{
  position:fixed;
  inset:0;
  background:radial-gradient(circle at center,#0a0f18,#000);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:10;
  transition:opacity .6s ease;
  overflow:hidden;
}
.loading-text{
  letter-spacing:6px;
  margin-bottom:20px;
  font-size:12px;
  opacity:.8;
  text-align:center;
  animation:flicker 2s infinite;
  max-width:90vw;
}
@keyframes flicker{0%,100%{opacity:.8}50%{opacity:1}}
.spinner{
  width:40px;height:40px;
  border:3px solid rgba(255,255,255,.1);
  border-top:3px solid #00d4ff;
  border-radius:50%;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
#enterBox{
  margin-top:34px;
  padding:18px 70px;
  border-radius:10px;
  background:rgba(10,20,35,0.6);
  border:1px solid rgba(0,200,255,0.4);
  backdrop-filter:blur(25px);
  letter-spacing:8px;
  font-weight:600;
  font-size:14px;
  color:#cfefff;
  text-shadow:0 0 8px rgba(0,200,255,0.7);
  opacity:0;
  pointer-events:none;
  transition:.4s ease;
  cursor:pointer;
  user-select:none;
}
#enterBox.show{opacity:1; pointer-events:auto;}

#enterHint{
  margin-top:12px;
  font-size:10px;
  letter-spacing:4px;
  opacity:0;
  transition:.35s ease;
  color:rgba(207,239,255,.75);
  text-shadow:0 0 10px rgba(0,200,255,.22);
  user-select:none;
}
#enterHint.show{opacity:.85;}

#enterScan{
  position:absolute;
  inset:0;
  pointer-events:none;
  opacity:0;
  z-index:0;
}
#enterScan::before{
  content:"";
  position:absolute;
  left:-40%;
  top:0;
  width:45%;
  height:100%;
  background:linear-gradient(90deg, transparent, rgba(0,200,255,.10), rgba(207,239,255,.12), rgba(0,200,255,.10), transparent);
  transform:skewX(-14deg) translateX(-120%);
  filter: blur(1px);
}
#loadingScreen.scan-on #enterScan{ opacity:1; }
#loadingScreen.scan-on #enterScan::before{ animation: enterScanPass .85s ease 1; }
@keyframes enterScanPass{
  0%{transform:skewX(-14deg) translateX(-120%); opacity:0}
  15%{opacity:1}
  100%{transform:skewX(-14deg) translateX(380%); opacity:0}
}

/* ✅ ENTER-only footer left */
#enterFooterLeft{
  position:fixed;
  left:18px;
  bottom:12px;
  z-index:11;
  font-size:9px;
  letter-spacing:3px;
  opacity:.35;
  user-select:none;
  text-shadow:0 0 10px rgba(0,200,255,.10);
}
body.entered #enterFooterLeft{ display:none; }

/* ✅ Version tag (sempre) */
#versionTag{
  position:fixed;
  right:18px;
  bottom:12px;
  z-index:6;
  font-size:9px;
  letter-spacing:3px;
  opacity:.35;
  user-select:none;
  text-shadow:0 0 10px rgba(0,200,255,.10);
}
#versionTag .v{opacity:.85;color:rgba(207,239,255,.85);}
#loadingScreen #versionTag{ z-index:12; }

/* ========= HUDS ========= */
.hud{
  position:fixed;
  bottom:20px;
  left:30px;
  font-size:10px;
  opacity:.4;
  letter-spacing:2px;
  animation:blink 4s infinite;
  z-index:6;
}
@keyframes blink{0%,100%{opacity:.4}50%{opacity:.12}}

#coordsHUD{
  position:fixed;
  top:18px;
  right:22px;
  font-size:10px;
  letter-spacing:2px;
  opacity:.45;
  z-index:6;
  text-align:right;
  user-select:none;
}
#coordsHUD .line{opacity:.7}
#coordsHUD .blink{animation:coordsBlink 2.8s infinite}
@keyframes coordsBlink{0%,100%{opacity:.55}50%{opacity:.15}}

#techHUD{
  position:fixed;
  top:80px;
  left:24px;
  width:min(360px, 42vw);
  font-size:10px;
  letter-spacing:2px;
  opacity:.35;
  z-index:6;
  user-select:none;
  line-height:1.55;
}
#techHUD .tag{opacity:.85}
#techHUD .value{opacity:.9; color:rgba(207,239,255,.95)}
#techHUD .sep{opacity:.25}

/* ✅ agora: COORD + SYS só no ENTER */
body.entered #coordsHUD,
body.entered #techHUD{ display:none; }

/* ===== Status Strip (thin left micro logs) ===== */
#statusStrip{
  position:fixed;
  left:10px;
  top:140px;
  width:min(180px, 30vw);
  z-index:6;
  opacity:.30;
  user-select:none;
  pointer-events:none;
  font-size:9px;
  letter-spacing:2px;
  line-height:1.45;
  text-shadow:0 0 10px rgba(0,200,255,.10);
  filter: drop-shadow(0 0 18px rgba(0,200,255,.10));
}
#statusStrip .statusLine{
  display:flex;
  gap:8px;
  align-items:baseline;
  padding:4px 6px;
  border-left:1px solid rgba(0,200,255,.22);
  background:linear-gradient(90deg, rgba(0,200,255,.04), transparent 70%);
}
#statusStrip .statusLine + .statusLine{ margin-top:4px; }
#statusStrip .k{opacity:.75}
#statusStrip .v{opacity:.9; color:rgba(207,239,255,.92)}
#statusStrip .faint{opacity:.6}
@media (max-width: 768px){
  #statusStrip{display:none;}
}

/* ===== Top controls ===== */
#topControls{
  position:fixed;
  top:16px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:12px;
  z-index:25;
  opacity:.92;
  transition:.18s ease;
  filter: drop-shadow(0 0 18px rgba(0,200,255,.22));
}
#topControls:hover{opacity:1}

.ctrlBtn{
  width:42px;height:34px;
  border-radius:12px;
  border:1px solid rgba(0,200,255,.72);
  background:
    radial-gradient(circle at 30% 30%, rgba(0,200,255,.10), transparent 55%),
    linear-gradient(180deg, rgba(12,24,44,.78), rgba(0,0,0,.50));
  backdrop-filter: blur(20px);
  color:rgba(207,239,255,.98);
  cursor:pointer;
  display:grid;
  place-items:center;
  font-size:14px;
  letter-spacing:2px;
  box-shadow:
    0 0 0 1px rgba(0,0,0,.25) inset,
    0 12px 34px rgba(0,0,0,.32);
  position:relative;
  overflow:hidden;
}
.ctrlBtn::before{
  content:"";
  position:absolute;
  inset:2px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,.06);
  pointer-events:none;
}
.ctrlBtn::after{
  content:"";
  position:absolute;
  inset:-40% -30%;
  background:linear-gradient(90deg, transparent, rgba(0,200,255,.22), transparent);
  transform:rotate(12deg) translateX(-90%);
  opacity:.0;
  pointer-events:none;
}
#topControls:hover .ctrlBtn::after{
  opacity:1;
  animation:scanPass 1.05s ease infinite;
}
@keyframes scanPass{
  0%{transform:rotate(12deg) translateX(-90%);}
  100%{transform:rotate(12deg) translateX(90%);}
}
.ctrlBtn:hover{
  transform: translateY(-1px);
  box-shadow:
    0 0 0 1px rgba(0,0,0,.25) inset,
    0 16px 42px rgba(0,0,0,.38),
    0 0 26px rgba(0,200,255,.18);
}
.ctrlBtn:active{transform:translateY(1px)}
.ctrlBtn:focus-visible{
  outline:none;
  box-shadow: 0 0 0 2px rgba(0,200,255,.55), 0 16px 42px rgba(0,0,0,.38);
}

/* ===== Social control (LINKS button) ===== */
#socialControl{
  position:fixed;
  top:14px;
  right:18px;
  z-index:26;
  opacity:.92;
  transition:.18s ease;
  filter: drop-shadow(0 0 16px rgba(160,230,255,.18));
}
#socialControl:hover{opacity:1}

.linkPill{
  height:28px;
  padding:0 10px;
  border-radius:999px;
  border:1px solid rgba(170,240,255,.45);
  background:
    radial-gradient(circle at 30% 30%, rgba(170,240,255,.12), transparent 58%),
    linear-gradient(180deg, rgba(0,0,0,.18), rgba(0,0,0,.10));
  backdrop-filter: blur(18px);
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:7px;
  color:rgba(235,252,255,.96);
  letter-spacing:3px;
  font-size:8px;
  box-shadow:
    0 0 0 1px rgba(255,255,255,.04) inset,
    0 10px 30px rgba(0,0,0,.26);
  position:relative;
}
.linkPill svg{
  width:16px;
  height:16px;
  opacity:.95;
  filter:drop-shadow(0 0 10px rgba(170,240,255,.18));
}
.linkPill:hover{
  box-shadow:
    0 0 0 1px rgba(255,255,255,.06) inset,
    0 14px 36px rgba(0,0,0,.32),
    0 0 18px rgba(170,240,255,.10);
  transform: translateY(-1px);
}
.linkPill:active{transform:translateY(1px);}

@media (max-width: 520px){
  .linkPill span{display:none;}
  .linkPill{padding:0 9px;}
}

/* ===== V5: ROUTES NODE (VERTICAL DOCK) ===== */
#routesNode{
  position:fixed;
  top:52px;
  right:18px;
  z-index:26;
  display:none;
}
#routesNode.show{display:block;}

.routesBox{
  width:64px;
  padding:8px 7px;
  border-radius:16px;
  border:1px solid rgba(170,240,255,.20);
  background:
    radial-gradient(circle at 30% 15%, rgba(170,240,255,.10), transparent 60%),
    linear-gradient(180deg, rgba(10,20,35,.38), rgba(0,0,0,.26));
  backdrop-filter: blur(20px);
  box-shadow:0 16px 50px rgba(0,0,0,.42);
  display:flex;
  flex-direction:column;
  gap:8px;
}

/* botão ícone */
.routeBtn{
  width:50px;
  height:50px;
  border-radius:16px;
  border:1px solid rgba(170,240,255,.16);
  background:
    radial-gradient(circle at 30% 30%, rgba(170,240,255,.09), transparent 62%),
    linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.26));
  box-shadow:0 0 0 1px rgba(0,0,0,.25) inset;
  display:grid;
  place-items:center;
  cursor:pointer;
  position:relative;
  overflow:visible;

  opacity:0;
  transform:translateY(-6px);
}

/* animação ao abrir */
#routesNode.show .routeBtn{ animation: dockIn .20s ease forwards; }
#routesNode.show .routeBtn:nth-child(1){animation-delay:.02s}
#routesNode.show .routeBtn:nth-child(2){animation-delay:.06s}
#routesNode.show .routeBtn:nth-child(3){animation-delay:.10s}
#routesNode.show .routeBtn:nth-child(4){animation-delay:.14s}
@keyframes dockIn{ to{opacity:1; transform:none;} }

.routeBtn:hover{
  border-color: rgba(170,240,255,.30);
  box-shadow:
    0 0 0 1px rgba(0,0,0,.25) inset,
    0 0 22px rgba(170,240,255,.12);
  transform: translateY(-1px);
}

/* ✅ ícones do menu menores */
.routeIcon svg{
  width:14px;
  height:14px;
  opacity:.92;
  filter:drop-shadow(0 0 10px rgba(170,240,255,.16));
}

/* tooltip label (legível: branco/azul) */
.routeTip{
  position:absolute;
  right: calc(100% + 10px);
  top:50%;
  transform:translateY(-50%) translateX(10px);
  opacity:0;
  pointer-events:none;
  transition:.18s ease;

  padding:9px 11px;
  border-radius:14px;
  border:1px solid rgba(170,240,255,.22);
  background:rgba(0,0,0,.40);
  backdrop-filter: blur(14px);
  box-shadow:0 14px 40px rgba(0,0,0,.40);

  white-space:nowrap;
  min-width: 170px;
}

.routeTip .t{
  display:block;
  font-size:9px;
  letter-spacing:4px;
  color:rgba(235,252,255,.98);
  text-shadow:0 0 10px rgba(0,200,255,.20);
}
.routeTip .s{
  display:block;
  margin-top:3px;
  font-size:8px;
  letter-spacing:2px;
  color:rgba(170,240,255,.80);
  opacity:1;
}

.routeBtn:hover .routeTip{
  opacity:1;
  transform:translateY(-50%) translateX(0);
}

/* ========= VOLUME ========= */
#volumeHUD{
  position:fixed;
  top:22px;
  left:24px;
  display:flex;
  align-items:flex-start;
  gap:12px;
  z-index:20;
  opacity:.55;
  transition:.25s ease;
}
#volumeHUD:hover{ opacity:1; }
.vol-btn{
  position:relative;
  width:40px;height:40px;
  border-radius:12px;
  border:1px solid rgba(0,200,255,.45);
  background:linear-gradient(180deg, rgba(10,20,35,.65), rgba(5,10,18,.55));
  backdrop-filter: blur(18px);
  display:grid;
  place-items:center;
  cursor:pointer;
  padding:0;
  box-shadow:0 0 0 1px rgba(0,0,0,.25) inset;
}
.vol-btn::before{
  content:"";
  position:absolute; inset:-1px;
  border-radius:12px;
  background:
    radial-gradient(circle at 30% 30%, rgba(0,200,255,.18), transparent 55%),
    radial-gradient(circle at 70% 70%, rgba(207,239,255,.10), transparent 55%);
  pointer-events:none;
}
.vol-svg{width:26px;height:26px;filter:drop-shadow(0 0 10px rgba(0,200,255,.45));}
.vol-state{
  position:absolute;
  left:50%; bottom:-9px;
  transform:translateX(-50%);
  font-size:8px;
  letter-spacing:2px;
  padding:2px 6px;
  border-radius:999px;
  border:1px solid rgba(255,90,90,.45);
  background:rgba(0,0,0,.35);
  color:rgba(255,190,190,.95);
  text-shadow:0 0 8px rgba(255,90,90,.25);
  display:none; /* ✅ só MUTED */
}
.vol-panel{
  width:0;
  opacity:0;
  pointer-events:none;
  transform:translateY(-2px);
  transition:.25s ease;
  padding:10px 0;
  border-radius:14px;
  border:1px solid rgba(0,200,255,.35);
  background:
    linear-gradient(180deg, rgba(10,20,35,.72), rgba(0,0,0,.55)),
    repeating-linear-gradient(90deg, rgba(255,255,255,.05) 0 1px, transparent 1px 10px);
  backdrop-filter: blur(22px);
  box-shadow: 0 12px 40px rgba(0,0,0,.45);
  overflow:hidden;
}
#volumeHUD:hover .vol-panel,
#volumeHUD.open .vol-panel{
  width:240px;
  opacity:1;
  pointer-events:auto;
  padding:10px 12px;
}
.vol-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;}
.vol-title{font-size:9px;letter-spacing:3px;opacity:.75;}
.vol-readout{font-size:10px;letter-spacing:2px;color:#cfefff;text-shadow:0 0 10px rgba(0,200,255,.35);}
#volSlider{
  width:100%;
  height:26px;
  background:transparent;
  appearance:none;
  -webkit-appearance:none;
  cursor:pointer;
}
#volSlider::-webkit-slider-runnable-track{
  height:6px;border-radius:999px;
  background:
    linear-gradient(90deg, rgba(0,200,255,.95), rgba(0,200,255,.25)),
    repeating-linear-gradient(90deg, rgba(255,255,255,.14) 0 1px, transparent 1px 8px);
  box-shadow:0 0 18px rgba(0,200,255,.18);
  border:1px solid rgba(0,200,255,.25);
}
#volSlider::-webkit-slider-thumb{
  -webkit-appearance:none;
  width:16px;height:16px;border-radius:6px;
  margin-top:-6px;
  background: radial-gradient(circle at 30% 30%, rgba(207,239,255,1), rgba(0,200,255,.55));
  border:1px solid rgba(0,200,255,.65);
  box-shadow:0 0 18px rgba(0,200,255,.55);
}
#volSlider::-moz-range-track{
  height:6px;border-radius:999px;
  background:
    linear-gradient(90deg, rgba(0,200,255,.95), rgba(0,200,255,.25)),
    repeating-linear-gradient(90deg, rgba(255,255,255,.14) 0 1px, transparent 1px 8px);
  border:1px solid rgba(0,200,255,.25);
}
#volSlider::-moz-range-thumb{
  width:16px;height:16px;border-radius:6px;
  background: radial-gradient(circle at 30% 30%, rgba(207,239,255,1), rgba(0,200,255,.55));
  border:1px solid rgba(0,200,255,.65);
  box-shadow:0 0 18px rgba(0,200,255,.55);
}
.vol-footer{
  margin-top:8px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  font-size:9px;
  letter-spacing:3px;
  opacity:.65;
}
.vol-bars{
  width:70px;
  height:10px;
  border-radius:6px;
  background:repeating-linear-gradient(90deg, rgba(0,200,255,var(--bars-a,.55)) 0 6px, transparent 6px 10px);
  filter: drop-shadow(0 0 10px rgba(0,200,255,.25));
  clip-path: inset(0 calc(100% - var(--bars-w,50%)) 0 0 round 6px);
  transition: clip-path .08s linear;
}

/* ========= TERMINAL ========= */
#terminal{
  position:fixed;
  inset:0;
  z-index:30;
  display:none;
  background:rgba(0,0,0,.65);
  backdrop-filter: blur(18px);
}
#terminal.show{display:block;}
.termBox{
  position:absolute;
  left:24px;
  bottom:24px;
  width:min(720px, calc(100vw - 48px));
  border-radius:16px;
  border:1px solid rgba(0,200,255,.35);
  background:linear-gradient(180deg, rgba(10,20,35,.75), rgba(0,0,0,.6));
  box-shadow:0 18px 60px rgba(0,0,0,.55);
  overflow:hidden;
}
.termHeader{
  display:flex;
  justify-content:space-between;
  padding:10px 12px;
  font-size:10px;
  letter-spacing:3px;
  opacity:.8;
  border-bottom:1px solid rgba(255,255,255,.08);
}
.termLog{
  max-height:min(46vh, 420px);
  overflow:auto;
  padding:12px;
  font-size:11px;
  line-height:1.55;
  letter-spacing:1px;
  opacity:.9;
}
.termLog .dim{opacity:.55}
.termLine{margin:2px 0}
.cursor{
  display:inline-block;
  margin-left:6px;
  opacity:.9;
  animation:cursorBlink 1s steps(2) infinite;
}
@keyframes cursorBlink{
  0%,49%{opacity:1}
  50%,100%{opacity:0}
}
.termInputBar{
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px 12px 12px 12px;
  border-top:1px solid rgba(255,255,255,.08);
  background:linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.22));
}
.termPrompt{
  font-size:10px;
  letter-spacing:2px;
  opacity:.75;
  user-select:none;
  white-space:nowrap;
}
#termInput{
  flex:1;
  height:32px;
  border-radius:12px;
  border:1px solid rgba(0,200,255,.25);
  background:rgba(0,0,0,.35);
  color:rgba(207,239,255,.95);
  padding:0 12px;
  font-family:'Orbitron', sans-serif;
  letter-spacing:1px;
  font-size:11px;
  outline:none;
  box-shadow:0 0 0 1px rgba(0,0,0,.25) inset;
}
#termInput::placeholder{ color:rgba(207,239,255,.45); }
#termInput:disabled{ opacity:.55; cursor:not-allowed; }
.termHint{
  font-size:9px;
  letter-spacing:2px;
  opacity:.55;
  user-select:none;
  white-space:nowrap;
}

/* ========= CATALOG ========= */
#catalog{
  position:fixed;
  inset:0;
  z-index:29;
  display:none;
  background:rgba(0,0,0,.62);
  backdrop-filter: blur(18px);
}
#catalog.show{display:block;}
.catBox{
  position:absolute;
  right:24px;
  bottom:24px;
  width:min(860px, calc(100vw - 48px));
  border-radius:16px;
  border:1px solid rgba(0,200,255,.30);
  background:linear-gradient(180deg, rgba(10,20,35,.72), rgba(0,0,0,.58));
  box-shadow:0 18px 60px rgba(0,0,0,.55);
  overflow:hidden;
}
.catHeader{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  padding:10px 12px;
  font-size:10px;
  letter-spacing:3px;
  opacity:.85;
  border-bottom:1px solid rgba(255,255,255,.08);
  flex-wrap:wrap;
}
.catHeader .dim{opacity:.55}
.catBody{
  padding:12px;
  max-height:min(56vh, 520px);
  overflow:auto;
}
.catGrid{
  display:grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap:12px;
}
@media (max-width: 900px){
  .catGrid{grid-template-columns:1fr;}
}
.catCard{
  border-radius:14px;
  border:1px solid rgba(0,200,255,.22);
  background:
    radial-gradient(circle at 30% 20%, rgba(0,200,255,.08), transparent 55%),
    linear-gradient(180deg, rgba(0,0,0,.20), rgba(0,0,0,.35));
  overflow:hidden;
  box-shadow:0 0 0 1px rgba(0,0,0,.25) inset;
}
.catThumb{
  position:relative;
  width:100%;
  aspect-ratio: 16 / 9;
  background:
    radial-gradient(circle at 40% 35%, rgba(0,200,255,.10), transparent 60%),
    linear-gradient(180deg, rgba(12,24,44,.70), rgba(0,0,0,.55));
  border-bottom:1px solid rgba(255,255,255,.06);
  overflow:hidden;
}
.catThumb img{
  width:100%;
  height:100%;
  object-fit:cover;
  filter: grayscale(.35) contrast(1.05) brightness(.78) saturate(1.1);
  transform: translateZ(0);
}
.catThumb::after{
  content:"";
  position:absolute;
  inset:0;
  background:
    linear-gradient(180deg, rgba(0,0,0,.20), rgba(0,0,0,.60)),
    repeating-linear-gradient(0deg, rgba(255,255,255,.05) 0 1px, transparent 1px 4px);
  mix-blend-mode:overlay;
  opacity:.55;
  pointer-events:none;
}
.catThumb.noimg::before{
  content:"NO SIGNAL";
  position:absolute;
  left:12px;
  top:12px;
  font-size:10px;
  letter-spacing:4px;
  opacity:.65;
  color:rgba(207,239,255,.75);
  text-shadow:0 0 10px rgba(0,200,255,.18);
  z-index:2;
}
.catStamp{
  position:absolute;
  left:10px;
  bottom:10px;
  z-index:2;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(0,200,255,.35);
  background:rgba(0,0,0,.45);
  backdrop-filter: blur(12px);
  font-size:9px;
  letter-spacing:2px;
  color:rgba(207,239,255,.95);
  text-shadow:0 0 10px rgba(0,200,255,.22);
  box-shadow:0 0 0 1px rgba(0,0,0,.25) inset;
}
.catContent{ padding:10px 12px 12px 12px; }
.catTitle{ font-size:11px; letter-spacing:2px; opacity:.92; margin-bottom:6px; }
.catDesc{ font-size:10px; letter-spacing:1px; line-height:1.55; opacity:.80; }
.catMeta{
  margin-top:10px;
  display:flex;
  justify-content:space-between;
  gap:10px;
  font-size:9px;
  letter-spacing:2px;
  opacity:.55;
}
.catBadge{ display:inline-flex; align-items:center; gap:8px; }
.catDot{
  width:7px;height:7px;border-radius:50%;
  background:rgba(0,200,255,.75);
  box-shadow:0 0 12px rgba(0,200,255,.35);
  flex:0 0 auto;
}
.catRight{ white-space:nowrap; }

/* INDEX FILTER (dry toggles) */
.catFilters{
  display:flex;
  align-items:center;
  gap:10px;
  flex-wrap:wrap;
}
.catFilters .label{
  font-size:9px;
  letter-spacing:3px;
  opacity:.55;
  margin-right:4px;
}
.fToggle{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:6px 10px;
  border-radius:12px;
  border:1px solid rgba(0,200,255,.22);
  background:rgba(0,0,0,.22);
  box-shadow:0 0 0 1px rgba(0,0,0,.25) inset;
  user-select:none;
}
.fToggle input{ width:14px;height:14px; accent-color: rgba(0,200,255,.85); }
.fToggle span{ font-size:9px; letter-spacing:3px; opacity:.78; }
.fToggle.off{ opacity:.45; border-color: rgba(255,255,255,.10); }

/* ========= CHANNELS (V5: Redes sociais) ========= */
#channels{
  position:fixed;
  inset:0;
  z-index:28;
  display:none;
  background:rgba(0,0,0,.58);
  backdrop-filter: blur(16px);
}
#channels.show{display:block;}
.chBox{
  position:absolute;
  left:50%;
  bottom:24px;
  transform:translateX(-50%);
  width:min(1040px, calc(100vw - 48px));
  border-radius:16px;
  border:1px solid rgba(0,200,255,.28);
  background:linear-gradient(180deg, rgba(10,20,35,.70), rgba(0,0,0,.58));
  box-shadow:0 18px 60px rgba(0,0,0,.55);
  overflow:hidden;
}
.chHeader{
  display:flex;
  justify-content:space-between;
  padding:10px 12px;
  font-size:10px;
  letter-spacing:3px;
  opacity:.85;
  border-bottom:1px solid rgba(255,255,255,.08);
}
.chHeader .dim{opacity:.55}

.chGrid{
  display:grid;
  grid-template-columns:repeat(2, minmax(0,1fr));
  gap:16px;
  padding:14px;
}
@media (max-width: 900px){
  .chGrid{grid-template-columns:1fr;}
}

/* Top cards */
.chTopCard{
  border-radius:16px;
  border:1px solid rgba(255,255,255,.06);
  background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,.16));
  padding:18px 18px 16px 18px;
  position:relative;
  overflow:hidden;
  text-decoration:none;
  color:inherit;
}
.chTopCard::before{
  content:"";
  position:absolute;
  inset:-40% -30%;
  background:linear-gradient(90deg, transparent, rgba(0,200,255,.12), transparent);
  transform:rotate(14deg) translateX(-90%);
  opacity:0;
}
.chTopCard:hover::before{
  opacity:1;
  animation:scanPass 1.05s ease infinite;
}
.chCircle{
  width:150px;height:150px;
  margin:6px auto 14px auto;
  border-radius:50%;
  border:2px solid rgba(207,239,255,.65);
  box-shadow:0 0 26px rgba(0,200,255,.12);
  display:grid;
  place-items:center;
  background:radial-gradient(circle at 30% 30%, rgba(0,200,255,.08), transparent 55%);
}
.chCircle img{
  width:56px;height:56px;
  filter: drop-shadow(0 0 12px rgba(0,200,255,.20));
  opacity:.95;
}
.chLabel{
  text-align:center;
  font-size:22px;
  letter-spacing:3px;
  opacity:.92;
  margin-bottom:6px;
}
.chSub{
  text-align:center;
  font-size:10px;
  letter-spacing:3px;
  opacity:.55;
}

/* Bottom identity panels */
.idGrid{
  display:grid;
  grid-template-columns:repeat(2, minmax(0,1fr));
  gap:16px;
  padding:0 14px 14px 14px;
}
@media (max-width: 900px){
  .idGrid{grid-template-columns:1fr;}
}
.idPanel{
  border-radius:16px;
  border:1px solid rgba(0,200,255,.18);
  background:
    radial-gradient(circle at 18% 12%, rgba(0,200,255,.10), transparent 55%),
    linear-gradient(180deg, rgba(0,0,0,.18), rgba(0,0,0,.35));
  box-shadow:0 0 0 1px rgba(0,0,0,.25) inset;
  overflow:hidden;
}
.idHead{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 12px;
  border-bottom:1px solid rgba(255,255,255,.08);
  font-size:9px;
  letter-spacing:3px;
  opacity:.85;
}
.idHead .dim{opacity:.55}
.idBody{ padding:12px; }
.idFrame{
  width:100%;
  aspect-ratio: 16/10;
  border-radius:14px;
  border:1px solid rgba(170,240,255,.18);
  background:
    radial-gradient(circle at 35% 25%, rgba(170,240,255,.10), transparent 60%),
    linear-gradient(180deg, rgba(12,24,44,.55), rgba(0,0,0,.60));
  overflow:hidden;
  position:relative;
}
.idFrame img{
  width:100%;
  height:100%;
  object-fit:cover;
  filter: grayscale(.25) contrast(1.05) brightness(.82) saturate(1.05);
  opacity:.92;
}
.idHint{
  margin-top:10px;
  font-size:9px;
  letter-spacing:2px;
  opacity:.55;
  line-height:1.45;
}
.idAction{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(170,240,255,.22);
  background:rgba(0,0,0,.22);
  font-size:9px;
  letter-spacing:3px;
  color:rgba(225,250,255,.95);
  box-shadow:0 0 0 1px rgba(0,0,0,.25) inset;
  cursor:pointer;
  text-decoration:none;
}
.idAction:hover{ box-shadow:0 0 0 1px rgba(0,0,0,.25) inset, 0 0 22px rgba(170,240,255,.10); }

/* ========= ADMIN ========= */
#admin{
  position:fixed;
  inset:0;
  z-index:27;
  display:none;
  background:rgba(0,0,0,.62);
  backdrop-filter: blur(18px);
}
#admin.show{display:block;}
.adminBox{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  width:min(980px, calc(100vw - 48px));
  border-radius:16px;
  border:1px solid rgba(0,200,255,.30);
  background:linear-gradient(180deg, rgba(10,20,35,.72), rgba(0,0,0,.58));
  box-shadow:0 18px 60px rgba(0,0,0,.55);
  overflow:hidden;
}
.adminHeader{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 12px;
  font-size:10px;
  letter-spacing:3px;
  opacity:.85;
  border-bottom:1px solid rgba(255,255,255,.08);
}
.adminHeader .dim{opacity:.55}
.adminBody{ padding:14px; }

.adminField{
  border-radius:14px;
  border:1px solid rgba(0,200,255,.22);
  background:
    radial-gradient(circle at 30% 20%, rgba(0,200,255,.08), transparent 55%),
    linear-gradient(180deg, rgba(0,0,0,.20), rgba(0,0,0,.35));
  box-shadow:0 0 0 1px rgba(0,0,0,.25) inset;
  padding:12px;
}
.adminLabel{ font-size:9px; letter-spacing:3px; opacity:.55; margin-bottom:8px; }
.adminValue{ font-size:14px; letter-spacing:2px; opacity:.92; }
.adminInput{
  width:100%;
  height:40px;
  border-radius:12px;
  border:1px solid rgba(0,200,255,.25);
  background:rgba(0,0,0,.35);
  color:rgba(207,239,255,.95);
  padding:0 12px;
  font-family:'Orbitron', sans-serif;
  letter-spacing:1px;
  font-size:12px;
  outline:none;
  box-shadow:0 0 0 1px rgba(0,0,0,.25) inset;
}
.adminInput::placeholder{ color:rgba(207,239,255,.45); }

.adminActions{
  margin-top:12px;
  display:flex;
  align-items:center;
  gap:10px;
  flex-wrap:wrap;
}
.aBtn{
  height:34px;
  padding:0 14px;
  border-radius:12px;
  border:1px solid rgba(0,200,255,.42);
  background:linear-gradient(180deg, rgba(12,24,44,.70), rgba(0,0,0,.45));
  color:rgba(207,239,255,.95);
  cursor:pointer;
  letter-spacing:3px;
  font-size:10px;
  box-shadow:0 0 0 1px rgba(0,0,0,.25) inset;
}
.aBtn:hover{ box-shadow:0 0 0 1px rgba(0,0,0,.25) inset, 0 0 20px rgba(0,200,255,.10); }
.aBtn:active{ transform: translateY(1px); }

.aPill{
  font-size:10px;
  letter-spacing:2px;
  opacity:.8;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.22);
}
.aPill.ok{ border-color: rgba(0,200,255,.25); color: rgba(207,239,255,.92); }
.aPill.bad{ border-color: rgba(255,90,90,.35); color: rgba(255,190,190,.95); }

.adminStats{
  margin-top:14px;
  display:grid;
  grid-template-columns: repeat(3, minmax(0,1fr));
  gap:12px;
}
@media (max-width: 900px){
  .adminStats{ grid-template-columns:1fr; }
}
.statCard{
  border-radius:14px;
  border:1px solid rgba(0,200,255,.18);
  background:linear-gradient(180deg, rgba(0,0,0,.22), rgba(0,0,0,.36));
  padding:12px;
  box-shadow:0 0 0 1px rgba(0,0,0,.25) inset;
}
.statTitle{ font-size:9px; letter-spacing:3px; opacity:.55; margin-bottom:8px; }
.statVal{ font-size:22px; letter-spacing:2px; opacity:.95; }
.statSmall{ font-size:12px; opacity:.85; letter-spacing:2px; white-space:pre-line; }

.adminFooter{
  margin-top:12px;
  opacity:.55;
  font-size:9px;
  letter-spacing:2px;
  line-height:1.45;
}
.adminDangerRow{
  margin-top:12px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.aBtn.danger{
  border-color: rgba(255,90,90,.45);
  color: rgba(255,200,200,.95);
}
.aBtn.danger:hover{
  box-shadow:0 0 0 1px rgba(0,0,0,.25) inset, 0 0 22px rgba(255,90,90,.10);
}

/* ✅ views: login e dashboard separados */
#adminDash{ display:none; }
#admin.dash #adminLogin{ display:none; }
#admin.dash #adminDash{ display:block; }

/* glitch no Dottore */
.glitchName{ display:inline-block; }
.glitchName.on{
  animation: nameGlitch .55s steps(6) 1;
  text-shadow:
    -1px 0 rgba(255,90,90,.55),
     1px 0 rgba(0,200,255,.55),
     0 0 14px rgba(0,200,255,.15);
}
@keyframes nameGlitch{
  0%{transform:translateX(0); filter:none;}
  20%{transform:translateX(2px); filter:hue-rotate(8deg);}
  40%{transform:translateX(-2px); filter:contrast(1.15);}
  60%{transform:translateX(1px); filter:saturate(1.2);}
  80%{transform:translateX(-1px); filter:hue-rotate(-8deg);}
  100%{transform:none; filter:none;}
}

/* ========= GAMES PANEL (GameMix vibe: cinza + laranja) ========= */
#games{
  position:fixed;
  inset:0;
  z-index:28; /* abaixo do terminal (30) e catalog (29), mas acima do resto */
  display:none;
  background:rgba(0,0,0,.66);
  backdrop-filter: blur(10px);
}
#games.show{ display:block; }

.gmWrap{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  width:min(980px, calc(100vw - 48px));
  max-height: calc(100vh - 48px);
  overflow:auto;

  border-radius:10px;
  border:1px solid rgba(255,255,255,.08);
  background: linear-gradient(180deg, rgba(40,40,40,.92), rgba(22,22,22,.92));
  box-shadow:0 22px 70px rgba(0,0,0,.65);
  font-family: Arial, sans-serif; /* painel “fora do padrão” do site, igual tu pediu */
}

.gmTop{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:10px 12px;
  border-bottom:1px solid rgba(255,255,255,.08);
  background: linear-gradient(180deg, rgba(55,55,55,.92), rgba(28,28,28,.92));
}
.gmBrand{
  display:flex;
  align-items:baseline;
  gap:6px;
  font-weight:700;
  letter-spacing:.5px;
}
.gmBrand .a{ color:#ffffff; font-size:14px; }
.gmBrand .b{ color:#ff7a00; font-size:14px; }
.gmNav{
  display:flex;
  gap:14px;
  align-items:center;
  flex-wrap:wrap;
}
.gmNav a{
  text-decoration:none;
  color:rgba(240,240,240,.88);
  font-size:11px;
  letter-spacing:.8px;
  text-transform:uppercase;
}
.gmNav a:hover{ color:#ffffff; }
.gmNav a.active{
  color:#ff7a00;
  text-shadow:0 0 14px rgba(255,122,0,.20);
}

.gmBody{
  display:grid;
  grid-template-columns: 1.35fr .85fr;
  gap:14px;
  padding:14px;
}
@media (max-width: 900px){
  .gmBody{ grid-template-columns:1fr; }
}

.gmHero{
  border:1px solid rgba(255,255,255,.08);
  border-radius:8px;
  overflow:hidden;
  background:#1b1b1b;
}
.gmHero .heroImg{
  width:100%;
  aspect-ratio: 16/7.8;
  background:
    linear-gradient(180deg, rgba(0,0,0,.15), rgba(0,0,0,.55)),
    url("https://images.unsplash.com/photo-1542751371-adc38448a05e?auto=format&fit=crop&w=1400&q=70");
  background-size:cover;
  background-position:center;
  position:relative;
}
.gmHero .heroImg::after{
  content:"";
  position:absolute;
  inset:0;
  background:
    linear-gradient(90deg, rgba(0,0,0,.80), rgba(0,0,0,.12) 55%, rgba(0,0,0,.70));
  opacity:.85;
}
.gmHero .heroText{
  position:relative;
  padding:12px;
  margin-top:-2px;
}
.gmTag{
  display:inline-block;
  padding:3px 8px;
  border-radius:3px;
  background:#ff7a00;
  color:#111;
  font-weight:700;
  font-size:10px;
  letter-spacing:.6px;
  text-transform:uppercase;
}
.gmTitle{
  margin-top:8px;
  font-size:16px;
  color:#f2f2f2;
  font-weight:700;
}
.gmSub{
  margin-top:6px;
  font-size:12px;
  line-height:1.4;
  color:rgba(235,235,235,.78);
}

.gmGrid{
  margin-top:12px;
  display:grid;
  grid-template-columns: 1fr;
  gap:10px;
}
.gmRow{
  display:grid;
  grid-template-columns: 150px 1fr;
  gap:10px;
  border:1px solid rgba(255,255,255,.08);
  border-radius:8px;
  overflow:hidden;
  background:rgba(0,0,0,.20);
}
@media (max-width: 520px){
  .gmRow{ grid-template-columns: 1fr; }
}
.gmThumb{
  min-height:92px;
  background:#222;
  position:relative;
  overflow:hidden;
}
.gmThumb::before{
  content:"";
  position:absolute;
  inset:0;
  background:
    linear-gradient(180deg, rgba(0,0,0,.15), rgba(0,0,0,.65)),
    url("https://images.unsplash.com/photo-1550745165-9bc0b252726f?auto=format&fit=crop&w=800&q=70");
  background-size:cover;
  background-position:center;
  filter: saturate(.95) contrast(1.05) brightness(.85);
}
.gmThumb.alt::before{
  background:
    linear-gradient(180deg, rgba(0,0,0,.15), rgba(0,0,0,.70)),
    url("https://images.unsplash.com/photo-1511512578047-dfb367046420?auto=format&fit=crop&w=800&q=70");
  background-size:cover;
  background-position:center;
}
.gmThumb.alt2::before{
  background:
    linear-gradient(180deg, rgba(0,0,0,.15), rgba(0,0,0,.70)),
    url("https://images.unsplash.com/photo-1605902711622-cfb43c4437d1?auto=format&fit=crop&w=800&q=70");
  background-size:cover;
  background-position:center;
}
.gmStampSmall{
  position:absolute;
  left:8px;
  top:8px;
  padding:3px 7px;
  border-radius:3px;
  background:#ff7a00;
  color:#111;
  font-weight:700;
  font-size:9px;
  letter-spacing:.4px;
  text-transform:uppercase;
  z-index:2;
}
.gmRowBody{
  padding:10px 10px 10px 0;
}
@media (max-width: 520px){
  .gmRowBody{ padding:10px; }
}
.gmRowTitle{
  font-size:13px;
  font-weight:700;
  color:#f2f2f2;
}
.gmRowDesc{
  margin-top:6px;
  font-size:12px;
  color:rgba(235,235,235,.75);
  line-height:1.45;
}
.gmRowMeta{
  margin-top:8px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
  font-size:11px;
  color:rgba(235,235,235,.6);
}
.gmBtn{
  margin-left:auto;
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:6px 10px;
  border-radius:6px;
  border:1px solid rgba(255,122,0,.55);
  background:rgba(255,122,0,.12);
  color:#ffb47a;
  font-weight:700;
  text-decoration:none;
  text-transform:uppercase;
  letter-spacing:.5px;
  font-size:10px;
}
.gmBtn:hover{ background:rgba(255,122,0,.18); }

.gmSide{
  border:1px solid rgba(255,255,255,.08);
  border-radius:8px;
  background:rgba(0,0,0,.18);
  overflow:hidden;
}
.gmSideHead{
  padding:10px 12px;
  font-size:12px;
  font-weight:700;
  color:#f0f0f0;
  border-bottom:1px solid rgba(255,255,255,.08);
  background:linear-gradient(180deg, rgba(45,45,45,.95), rgba(20,20,20,.95));
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.gmSideHead .dim{ font-size:11px; color:rgba(235,235,235,.55); font-weight:400; }
.gmSideBody{
  padding:12px;
  display:grid;
  gap:10px;
}
.gmWidget{
  border:1px solid rgba(255,255,255,.08);
  border-radius:8px;
  background:rgba(0,0,0,.22);
  overflow:hidden;
}
.gmWidget .wHead{
  padding:8px 10px;
  border-bottom:1px solid rgba(255,255,255,.08);
  font-size:11px;
  color:#f0f0f0;
  font-weight:700;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.gmWidget .wHead .dot{
  width:6px;height:6px;border-radius:50%;
  background:#ff7a00;
  box-shadow:0 0 12px rgba(255,122,0,.35);
}
.gmWidget .wBody{
  padding:10px;
  font-size:12px;
  color:rgba(235,235,235,.72);
  line-height:1.45;
}
.gmList{
  margin-top:6px;
  display:grid;
  gap:8px;
}
.gmList a{
  display:flex;
  justify-content:space-between;
  gap:12px;
  text-decoration:none;
  color:rgba(235,235,235,.78);
  font-size:12px;
  padding:7px 8px;
  border-radius:6px;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.18);
}
.gmList a:hover{
  color:#fff;
  border-color: rgba(255,122,0,.35);
  box-shadow:0 0 18px rgba(255,122,0,.08);
}
.gmList a .tag{
  color:#ffb47a;
  font-weight:700;
  font-size:11px;
}

.gmFooter{
  padding:10px 12px 12px 12px;
  border-top:1px solid rgba(255,255,255,.08);
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  flex-wrap:wrap;
  background:rgba(0,0,0,.18);
}
.gmFooter .hint{
  font-size:11px;
  color:rgba(235,235,235,.55);
}
.gmClose{
  height:30px;
  padding:0 12px;
  border-radius:6px;
  border:1px solid rgba(255,122,0,.55);
  background:rgba(255,122,0,.12);
  color:#ffb47a;
  font-weight:700;
  font-size:10px;
  cursor:pointer;
  text-transform:uppercase;
  letter-spacing:.5px;
}
.gmClose:hover{ background:rgba(255,122,0,.18); }

/* reduced motion */
@media (prefers-reduced-motion: reduce){
  .scanlines{opacity:.35}
  .spinner{animation:none}
  #cinemaFX::before{animation:none}
  #topControls .ctrlBtn::after{animation:none; opacity:0;}
  #loadingScreen.scan-on #enterScan::before{animation:none !important;}
  #routesNode.show .routeBtn{animation:none; opacity:1; transform:none;}
}
@media (max-width: 768px){
  :root{ --blur-amount: 55px; }
  #techHUD{display:none;}
}
</style>
</head>

<body>

<video id="videoBlur" playsinline preload="auto" muted loop>
  <source src="https://files.catbox.moe/um6f2u.mp4" type="video/mp4" />
</video>

<video id="video" playsinline preload="auto" loop>
  <source src="https://files.catbox.moe/um6f2u.mp4" type="video/mp4" />
</video>

<audio id="ambience" preload="auto" loop>
  <source src="https://files.catbox.moe/3q1h1x.mp3" type="audio/mpeg">
</audio>

<div class="scanlines"></div>
<div id="cinemaFX"></div>
<div id="glitchFlash"></div>

<!-- ✅ version always -->
<div id="versionTag"><span class="v">dottore lab interface: v5</span></div>

<div id="loadingScreen">
  <div id="enterScan" aria-hidden="true"></div>
  <div class="loading-text" id="dynamicText">INITIALIZING EXPERIMENT...</div>
  <div class="spinner" id="spinner"></div>

  <div id="enterBox">ENTER</div>
  <div id="enterHint">PRESS [ENTER] TO PROCEED</div>

  <!-- ✅ enter-only line bottom left -->
  <div id="enterFooterLeft">NEURAL LINK ESTABLISHED // SUBJECT ONLINE</div>
</div>

<div id="coordsHUD">
  <div class="line blink" id="coordA">COORD: --.---- / --.----</div>
  <div class="line" id="coordB">NODE: Σ-07 // LINK: STABLE</div>
</div>

<div id="techHUD">
  <div class="termLine"><span class="tag">SYS</span> <span class="sep">//</span> <span class="value" id="sysClock">--:--:--</span></div>
  <div class="termLine"><span class="tag">STREAM</span> <span class="sep">//</span> <span class="value" id="sysStream">BUFFERING</span></div>
  <div class="termLine"><span class="tag">NEURAL</span> <span class="sep">//</span> <span class="value" id="sysNeural">CALIBRATING</span></div>
  <div class="termLine"><span class="tag">ETHICS</span> <span class="sep">//</span> <span class="value">DISABLED</span></div>
  <div class="termLine"><span class="tag">SUBJECT</span> <span class="sep">//</span> <span class="value" id="sysSubject">ONLINE</span></div>

  <div class="termLine"><span class="tag">PHASE</span> <span class="sep">//</span> <span class="value" id="sysPhase">BOOT</span></div>
  <div class="termLine"><span class="tag">DIRECTIVE</span> <span class="sep">//</span> <span class="value" id="sysDirective">MONITORING</span></div>
</div>

<!-- STATUS STRIP -->
<div id="statusStrip" aria-hidden="true">
  <div class="statusLine" id="ss1"><span class="k">STRIP</span> <span class="v">IDLE</span></div>
  <div class="statusLine faint" id="ss2"><span class="k">FEED</span> <span class="v">STANDBY</span></div>
  <div class="statusLine faint" id="ss3"><span class="k">TRACE</span> <span class="v">—</span></div>
</div>

<div id="topControls">
  <button class="ctrlBtn" id="btnFS" title="Tela cheia">⛶</button>
  <button class="ctrlBtn" id="btnCat" title="Catálogo">≡</button>
  <button class="ctrlBtn" id="btnTerm" title="Terminal">⌁</button>
  <button class="ctrlBtn" id="btnAdmin" title="Admin Console" aria-label="Abrir console admin">⌖</button>
</div>

<!-- Social / Links control -->
<div id="socialControl" aria-label="Outbound links">
  <button class="linkPill" id="btnLinks" type="button" title="Outbound Node" aria-label="Abrir node de rotas">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M10.6 13.4 8.5 15.5a3 3 0 0 1-4.2-4.2l2.1-2.1a3 3 0 0 1 4.2 0"
            fill="none" stroke="rgba(210,248,255,.95)" stroke-width="1.7" stroke-linecap="round"/>
      <path d="M13.4 10.6 15.5 8.5a3 3 0 0 1 4.2 4.2l-2.1 2.1a3 3 0 0 1-4.2 0"
            fill="none" stroke="rgba(170,240,255,.85)" stroke-width="1.7" stroke-linecap="round"/>
      <path d="M9.2 14.8 14.8 9.2"
            fill="none" stroke="rgba(120,220,255,.65)" stroke-width="1.6" stroke-linecap="round"/>
    </svg>
    <span>LINKS</span>
  </button>
</div>

<!-- V5: ROUTES NODE (vertical dock) -->
<div id="routesNode" aria-hidden="true">
  <div class="routesBox" role="navigation" aria-label="Rotas externas">
    <button class="routeBtn" id="rSocial" type="button" aria-label="Redes sociais" data-title="REDES SOCIAIS" data-sub="Discord / Instagram">
      <span class="routeIcon" aria-hidden="true">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M8 12a4 4 0 1 1 4 4" fill="none" stroke="rgba(210,248,255,.92)" stroke-width="1.7" stroke-linecap="round"/>
          <path d="M16 12a4 4 0 1 0-4-4" fill="none" stroke="rgba(120,220,255,.72)" stroke-width="1.7" stroke-linecap="round"/>
        </svg>
      </span>
      <span class="routeTip" aria-hidden="true">
        <span class="t">REDES SOCIAIS</span>
        <span class="s">Discord / Instagram</span>
      </span>
    </button>

    <button class="routeBtn" id="rGames" type="button" aria-label="Jogos" data-title="JOGOS" data-sub="Painel estilo portal">
      <span class="routeIcon" aria-hidden="true">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M7 15h10l2-6a3 3 0 0 0-3-3H8a3 3 0 0 0-3 3l2 6Z" fill="none" stroke="rgba(210,248,255,.92)" stroke-width="1.7" stroke-linejoin="round"/>
          <path d="M9.2 12h2.6M10.5 10.7v2.6" fill="none" stroke="rgba(120,220,255,.72)" stroke-width="1.7" stroke-linecap="round"/>
          <path d="M15.5 11.2h.01M16.8 12.8h.01" fill="none" stroke="rgba(120,220,255,.72)" stroke-width="2.2" stroke-linecap="round"/>
        </svg>
      </span>
      <span class="routeTip" aria-hidden="true">
        <span class="t">JOGOS</span>
        <span class="s">Painel estilo portal</span>
      </span>
    </button>

    <button class="routeBtn" id="rArchive" type="button" aria-label="Archive" data-title="ARCHIVE" data-sub="Galeria pessoal / imagens">
      <span class="routeIcon" aria-hidden="true">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M4 7h16v4H4V7Z" fill="none" stroke="rgba(210,248,255,.92)" stroke-width="1.7" stroke-linejoin="round"/>
          <path d="M6 11v9h12v-9" fill="none" stroke="rgba(120,220,255,.72)" stroke-width="1.7" stroke-linejoin="round"/>
          <path d="M10 15h4" fill="none" stroke="rgba(120,220,255,.72)" stroke-width="1.7" stroke-linecap="round"/>
        </svg>
      </span>
      <span class="routeTip" aria-hidden="true">
        <span class="t">ARCHIVE</span>
        <span class="s">Galeria pessoal / imagens</span>
      </span>
    </button>

    <button class="routeBtn" id="rTx" type="button" aria-label="Transmission" data-title="TRANSMISSION" data-sub="Presença sonora / playlist">
      <span class="routeIcon" aria-hidden="true">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 4v16" fill="none" stroke="rgba(210,248,255,.92)" stroke-width="1.7" stroke-linecap="round"/>
          <path d="M8 8a6 6 0 0 0 0 8" fill="none" stroke="rgba(120,220,255,.72)" stroke-width="1.7" stroke-linecap="round"/>
          <path d="M16 8a6 6 0 0 1 0 8" fill="none" stroke="rgba(120,220,255,.72)" stroke-width="1.7" stroke-linecap="round"/>
        </svg>
      </span>
      <span class="routeTip" aria-hidden="true">
        <span class="t">TRANSMISSION</span>
        <span class="s">Presença sonora / playlist</span>
      </span>
    </button>
  </div>
</div>

<div id="volumeHUD" class="vol" aria-label="Controle de volume" style="--bars-w:50%; --bars-a:.55;">
  <button id="volIconBtn" class="vol-btn" type="button" aria-label="Abrir controle de volume">
    <svg class="vol-svg" viewBox="0 0 24 24" aria-hidden="true">
      <path d="M3 10v4a2 2 0 0 0 2 2h3l5 4V4L8 8H5a2 2 0 0 0-2 2Z"
            fill="none" stroke="rgba(207,239,255,.95)" stroke-width="1.8" stroke-linejoin="round"/>
      <path d="M16 9c1 .8 1.5 1.8 1.5 3S17 14.2 16 15"
            fill="none" stroke="rgba(0,200,255,.75)" stroke-width="1.8" stroke-linecap="round"/>
      <path d="M18.5 7c1.6 1.4 2.5 3 2.5 5s-.9 3.6-2.5 5"
            fill="none" stroke="rgba(0,200,255,.45)" stroke-width="1.6" stroke-linecap="round"/>
    </svg>
    <span id="volState" class="vol-state">MUTED</span>
  </button>

  <div id="volPanel" class="vol-panel" role="group" aria-label="Ajuste de volume">
    <div class="vol-top">
      <div class="vol-title">AUDIO // MIX</div>
      <div id="volReadout" class="vol-readout">70%</div>
    </div>
    <input type="range" id="volSlider" min="0" max="1" step="0.01" value="0.7" />
    <div class="vol-footer">
      <span>OUTPUT</span>
      <span class="vol-bars" aria-hidden="true"></span>
    </div>
  </div>
</div>

<!-- CATALOG -->
<div id="catalog" aria-hidden="true">
  <div class="catBox">
    <div class="catHeader">
      <div>EXPERIMENT CATALOG // INDEX: Σ</div>

      <div class="catFilters" aria-label="Index Filter">
        <span class="label">INDEX FILTER</span>

        <label class="fToggle" id="fArchivedWrap">
          <input type="checkbox" id="fArchived" checked />
          <span>ARCHIVED</span>
        </label>

        <label class="fToggle" id="fActiveWrap">
          <input type="checkbox" id="fActive" checked />
          <span>ACTIVE</span>
        </label>

        <label class="fToggle" id="fSealedWrap">
          <input type="checkbox" id="fSealed" checked />
          <span>SEALED</span>
        </label>
      </div>

      <div class="dim">ESC para fechar</div>
    </div>
    <div class="catBody">
      <div id="catGrid" class="catGrid"></div>
    </div>
  </div>
</div>

<!-- CHANNELS (V5: Social panel) -->
<div id="channels" aria-hidden="true">
  <div class="chBox">
    <div class="chHeader">
      <div>OUTBOUND ROUTING // SOCIAL ACCESS</div>
      <div class="dim">ESC para fechar</div>
    </div>

    <div class="chGrid">
      <a class="chTopCard" id="linkDiscord" href="https://discord.gg/example" target="_blank" rel="noopener noreferrer">
        <div class="chCircle" aria-hidden="true">
          <img alt="" src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/discord.svg" decoding="async" loading="lazy">
        </div>
        <div class="chLabel">DISCORD NODE</div>
        <div class="chSub">REALTIME LINK</div>
      </a>

      <a class="chTopCard" id="linkInstagram" href="https://instagram.com/example" target="_blank" rel="noopener noreferrer">
        <div class="chCircle" aria-hidden="true">
          <img alt="" src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/instagram.svg" decoding="async" loading="lazy">
        </div>
        <div class="chLabel">INSTAGRAM NODE</div>
        <div class="chSub">VISUAL ARCHIVE</div>
      </a>
    </div>

    <div class="idGrid">
      <div class="idPanel">
        <div class="idHead">
          <div>IDENTITY // GENSHIN PROFILE</div>
          <a class="idAction" href="https://discord.gg/example" target="_blank" rel="noopener noreferrer" aria-label="Join Discord">JOIN CHANNEL</a>
        </div>
        <div class="idBody">
          <div class="idFrame">
            <img alt="" src="https://images.unsplash.com/photo-1542556391-64b7e906d4d2?auto=format&fit=crop&w=1400&q=60" loading="lazy" decoding="async" referrerpolicy="no-referrer">
          </div>
          <div class="idHint">Slot reservado para seu perfil customizado. Substitua a imagem quando quiser.</div>
        </div>
      </div>

      <div class="idPanel">
        <div class="idHead">
          <div>IDENTITY // SLOT-02</div>
          <a class="idAction" href="https://instagram.com/example" target="_blank" rel="noopener noreferrer" aria-label="Open Instagram">OPEN PROFILE</a>
        </div>
        <div class="idBody">
          <div class="idFrame">
            <img alt="" src="https://images.unsplash.com/photo-1520975916090-3105956dac38?auto=format&fit=crop&w=1400&q=60" loading="lazy" decoding="async" referrerpolicy="no-referrer">
          </div>
          <div class="idHint">Placeholder preparado para expansão futura. Mantém estética e hierarquia.</div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- ✅ GAMES PANEL -->
<div id="games" aria-hidden="true">
  <div class="gmWrap" role="dialog" aria-label="Painel de Jogos">
    <div class="gmTop">
      <div class="gmBrand">
        <span class="a">GAME</span><span class="b">MIX</span>
      </div>
      <nav class="gmNav" aria-label="Menu do painel">
        <a href="#" class="active" data-gm="home">HOME</a>
        <a href="#" data-gm="about">ABOUT</a>
        <a href="#" data-gm="boys">BOYS</a>
        <a href="#" data-gm="gallery">GALLERY</a>
        <a href="#" data-gm="contact">CONTACT</a>
      </nav>
    </div>

    <div class="gmBody">
      <div>
        <section class="gmHero" aria-label="Destaque">
          <div class="heroImg" aria-hidden="true"></div>
          <div class="heroText">
            <span class="gmTag">Featured</span>
            <div class="gmTitle">PAINEL // JOGOS & LINKS</div>
            <div class="gmSub">
              Aqui você pode colocar: links dos jogos, categorias (PC/PS/Xbox/Mobile), listas de mods, guias, saves e o que quiser.
              O layout tá no estilo “portal gamer” (cinza + laranja), separado do padrão do site.
            </div>
          </div>
        </section>

        <div class="gmGrid" aria-label="Lista">
          <article class="gmRow">
            <div class="gmThumb">
              <div class="gmStampSmall">NEW</div>
            </div>
            <div class="gmRowBody">
              <div class="gmRowTitle">HUB // JOGOS PRINCIPAIS</div>
              <div class="gmRowDesc">
                Lista dos jogos que você joga (com botões de link): Steam, Epic, launcher, ou páginas próprias.
              </div>
              <div class="gmRowMeta">
                <span>STATUS: ONLINE</span>
                <span>UPDATE: WEEKLY</span>
                <a class="gmBtn" href="#" onclick="return false;">OPEN</a>
              </div>
            </div>
          </article>

          <article class="gmRow">
            <div class="gmThumb alt">
              <div class="gmStampSmall">HOT</div>
            </div>
            <div class="gmRowBody">
              <div class="gmRowTitle">SEÇÃO // GUIAS & BUILDS</div>
              <div class="gmRowDesc">
                Builds, configurações, notas rápidas e “lembretes” pra não perder tempo quando voltar pro jogo.
              </div>
              <div class="gmRowMeta">
                <span>TYPE: NOTES</span>
                <span>ACCESS: PRIVATE</span>
                <a class="gmBtn" href="#" onclick="return false;">OPEN</a>
              </div>
            </div>
          </article>

          <article class="gmRow">
            <div class="gmThumb alt2">
              <div class="gmStampSmall">SAVE</div>
            </div>
            <div class="gmRowBody">
              <div class="gmRowTitle">ARQUIVO // MODS & PACKS</div>
              <div class="gmRowDesc">
                Links de mods, coleções, patches, e qualquer coisa que você quiser manter “catalogada”.
              </div>
              <div class="gmRowMeta">
                <span>NODE: ARCHIVE</span>
                <span>SYNC: MANUAL</span>
                <a class="gmBtn" href="#" onclick="return false;">OPEN</a>
              </div>
            </div>
          </article>
        </div>
      </div>

      <aside class="gmSide" aria-label="Sidebar">
        <div class="gmSideHead">
          <span>CONTROL PANEL</span>
          <span class="dim">ESC para fechar</span>
        </div>

        <div class="gmSideBody">
          <div class="gmWidget">
            <div class="wHead"><span>QUICK LINKS</span><span class="dot" aria-hidden="true"></span></div>
            <div class="wBody">
              <div class="gmList">
                <a href="#" onclick="return false;"><span>Steam Profile</span><span class="tag">OPEN</span></a>
                <a href="#" onclick="return false;"><span>Discord Server</span><span class="tag">JOIN</span></a>
                <a href="#" onclick="return false;"><span>Epic Library</span><span class="tag">OPEN</span></a>
                <a href="#" onclick="return false;"><span>Mods Folder</span><span class="tag">LINK</span></a>
              </div>
            </div>
          </div>

          <div class="gmWidget">
            <div class="wHead"><span>STATUS</span><span class="dot" aria-hidden="true"></span></div>
            <div class="wBody">
              <div>• Slots prontos pra você trocar por conteúdo real.</div>
              <div>• Cores e formato no estilo da referência.</div>
              <div>• Você decide depois o que vira “botão”, “card”, “lista”.</div>
            </div>
          </div>

          <div class="gmWidget">
            <div class="wHead"><span>NOTES</span><span class="dot" aria-hidden="true"></span></div>
            <div class="wBody">
              Quer que eu deixe essa área “editável” (tipo mini CMS local com localStorage), ou você vai editar direto no HTML?
            </div>
          </div>
        </div>
      </aside>
    </div>

    <div class="gmFooter">
      <div class="hint">GAMES PANEL // THEME: GRAPHITE + ORANGE</div>
      <button class="gmClose" id="gmCloseBtn" type="button">CLOSE</button>
    </div>
  </div>
</div>

<!-- ADMIN -->
<div id="admin" aria-hidden="true">
  <div class="adminBox">
    <div class="adminHeader">
      <div>ADMIN CONSOLE // AUTH REQUIRED</div>
      <div class="dim">ESC para fechar</div>
    </div>

    <div class="adminBody">

      <!-- LOGIN VIEW -->
      <div id="adminLogin">
        <div class="adminField" style="margin-bottom:12px;">
          <div class="adminLabel">USER</div>
          <div class="adminValue">Dottore</div>
        </div>

        <div class="adminField">
          <div class="adminLabel">PASS</div>
          <input id="adminPass" class="adminInput" type="password" autocomplete="off" spellcheck="false" placeholder="•••••••••" />
        </div>

        <div class="adminActions">
          <button class="aBtn" id="adminAuth">ACESSAR</button>
          <button class="aBtn" id="adminClear">LIMPAR</button>
          <div id="adminStatus" class="aPill">Aguardando autenticação…</div>
        </div>
      </div>

      <!-- DASH VIEW -->
      <div id="adminDash">
        <div class="adminStats">
          <div class="statCard">
            <div class="statTitle">VIEWS // ENTER</div>
            <div class="statVal" id="mViews">0</div>
          </div>
          <div class="statCard">
            <div class="statTitle">UNIQUE // DEVICE</div>
            <div class="statVal" id="mUnique">0</div>
          </div>
          <div class="statCard">
            <div class="statTitle">LAST ACCESS</div>
            <div class="statVal statSmall" id="mLast">—</div>
          </div>
        </div>

        <div class="adminDangerRow">
          <button class="aBtn danger" id="adminReset">RESET METRICS</button>
          <button class="aBtn" id="adminLock">LOCK</button>
        </div>

        <div class="adminFooter">
          Nota: métricas são locais (neste navegador/dispositivo). Sem backend, não existe contagem global real.
        </div>
      </div>

    </div>
  </div>
</div>

<!-- TERMINAL -->
<div id="terminal" aria-hidden="true">
  <div class="termBox">
    <div class="termHeader">
      <div>LAB TERMINAL // ACCESS: GRANTED</div>
      <div class="dim">ESC para fechar</div>
    </div>
    <div id="termLog" class="termLog"></div>

    <div class="termInputBar" aria-label="Console">
      <div class="termPrompt" id="termPrompt">root@lab:~$</div>
      <input id="termInput" type="text" autocomplete="off" spellcheck="false" placeholder="Digite um comando (ex: help)" />
      <div class="termHint" id="termHint">ENTER</div>
    </div>
  </div>
</div>

<script>
/* ===== ELEMENTS ===== */
const video = document.getElementById("video");
const videoBlur = document.getElementById("videoBlur");
const ambience = document.getElementById("ambience");

const enterBox = document.getElementById("enterBox");
const enterHint = document.getElementById("enterHint");
const loadingScreen = document.getElementById("loadingScreen");
const dynamicText = document.getElementById("dynamicText");
const spinner = document.getElementById("spinner");

const coordA = document.getElementById("coordA");
const coordB = document.getElementById("coordB");

const sysClock = document.getElementById("sysClock");
const sysStream = document.getElementById("sysStream");
const sysNeural = document.getElementById("sysNeural");
const sysSubject = document.getElementById("sysSubject");

const sysPhase = document.getElementById("sysPhase");
const sysDirective = document.getElementById("sysDirective");

const btnFS = document.getElementById("btnFS");
const btnTerm = document.getElementById("btnTerm");
const btnCat  = document.getElementById("btnCat");
const btnLinks = document.getElementById("btnLinks");
const btnAdmin = document.getElementById("btnAdmin");

const volumeHUD = document.getElementById("volumeHUD");
const volSlider = document.getElementById("volSlider");
const volIconBtn = document.getElementById("volIconBtn");
const volReadout = document.getElementById("volReadout");
const volState = document.getElementById("volState");

const terminal = document.getElementById("terminal");
const termLog = document.getElementById("termLog");

const termInput = document.getElementById("termInput");
const termPrompt = document.getElementById("termPrompt");
const termHint = document.getElementById("termHint");

const catalog = document.getElementById("catalog");
const catGrid = document.getElementById("catGrid");

const channels = document.getElementById("channels");
const admin = document.getElementById("admin");

/* ✅ Games panel */
const games = document.getElementById("games");
const gmCloseBtn = document.getElementById("gmCloseBtn");

/* V5 routes node */
const routesNode = document.getElementById("routesNode");
const rSocial = document.getElementById("rSocial");
const rGames = document.getElementById("rGames");
const rArchive = document.getElementById("rArchive");
const rTx = document.getElementById("rTx");

/* Catalog filter toggles */
const fArchived = document.getElementById("fArchived");
const fActive = document.getElementById("fActive");
const fSealed = document.getElementById("fSealed");
const fArchivedWrap = document.getElementById("fArchivedWrap");
const fActiveWrap = document.getElementById("fActiveWrap");
const fSealedWrap = document.getElementById("fSealedWrap");

/* Status Strip */
const ss1 = document.getElementById("ss1");
const ss2 = document.getElementById("ss2");
const ss3 = document.getElementById("ss3");

/* Admin */
const adminLogin = document.getElementById("adminLogin");
const adminDash = document.getElementById("adminDash");
const adminPass = document.getElementById("adminPass");
const adminAuth = document.getElementById("adminAuth");
const adminClear = document.getElementById("adminClear");
const adminStatus = document.getElementById("adminStatus");
const adminReset = document.getElementById("adminReset");
const adminLock = document.getElementById("adminLock");
const mViews = document.getElementById("mViews");
const mUnique = document.getElementById("mUnique");
const mLast = document.getElementById("mLast");

/* ===== FLAGS ===== */
let ambOn = true;
let hasEntered = false;

/* ===== STATUS STRIP (micro logs, NO spam) ===== */
let stripTimers = [];
function setStripLine(el, key, val){
  if (!el) return;
  el.innerHTML = `<span class="k">${key}</span> <span class="v">${val}</span>`;
}
function clearStripTimers(){
  for (const t of stripTimers) clearTimeout(t);
  stripTimers.length = 0;
}
function pulseStrip(eventLine, feedLine, traceLine){
  if (eventLine) setStripLine(ss1, "STRIP", eventLine);
  if (feedLine)  setStripLine(ss2, "FEED", feedLine);
  if (traceLine) setStripLine(ss3, "TRACE", traceLine);

  clearStripTimers();
  stripTimers.push(setTimeout(() => {
    setStripLine(ss2, "FEED", "STANDBY");
    ss2.classList.add("faint");
  }, 5200));
  stripTimers.push(setTimeout(() => {
    setStripLine(ss3, "TRACE", "—");
    ss3.classList.add("faint");
  }, 8200));
}
function stripPhase(phaseName){
  pulseStrip(
    `PHASE:${phaseName.replace("_"," ")}`,
    "TELEMETRY:SYNC",
    `DIR:${sysDirective.textContent || "—"}`
  );
  ss2.classList.remove("faint");
  ss3.classList.remove("faint");
}

/* ===== LOADING TEXT ===== */
const messages = [
  "INITIALIZING EXPERIMENT...",
  "STABILIZING MEMORY FRAGMENTS...",
  "NEURAL PATHWAYS SYNCHRONIZED...",
  "ETHICS MODULE DISABLED...",
  "SUBJECT AWARENESS: IRRELEVANT",
  "PROCEEDING WITHOUT CONSENT..."
];
let msgIndex = 0;
const msgTimer = setInterval(() => {
  msgIndex = (msgIndex + 1) % messages.length;
  dynamicText.textContent = messages[msgIndex];
}, 2200);

/* ✅ garante que ao carregar/voltar pro site, se não entrou, fica tudo parado */
function hardStopMediaIfNotEntered(){
  if (hasEntered) return;
  try{ video.pause(); video.currentTime = 0; }catch(e){}
  try{ videoBlur.pause(); videoBlur.currentTime = 0; }catch(e){}
  try{ ambience.pause(); ambience.currentTime = 0; }catch(e){}
}
document.addEventListener("DOMContentLoaded", hardStopMediaIfNotEntered);
window.addEventListener("pageshow", () => hardStopMediaIfNotEntered());

/* ===== READY / SAFETY ===== */
let readyToEnter = false;
let scanLoopTimer = null;

function playEnterScan(){
  loadingScreen.classList.remove("scan-on");
  void loadingScreen.offsetWidth;
  loadingScreen.classList.add("scan-on");
  setTimeout(()=>loadingScreen.classList.remove("scan-on"), 1100);
}
function startScanLoop(){
  if (scanLoopTimer) return;
  scanLoopTimer = setInterval(() => {
    const loadingVisible = loadingScreen.style.display !== "none" && getComputedStyle(loadingScreen).display !== "none";
    if (!loadingVisible) return;
    if (!enterBox.classList.contains("show")) return;
    playEnterScan();
  }, 5000);
}
function stopScanLoop(){
  if (!scanLoopTimer) return;
  clearInterval(scanLoopTimer);
  scanLoopTimer = null;
}
function setEnterHint(label){
  enterHint.textContent = (label === "RETRY") ? "PRESS [ENTER] TO RETRY" : "PRESS [ENTER] TO PROCEED";
  enterHint.classList.add("show");
}
function showEnter(label="ENTER"){
  enterBox.style.pointerEvents = "auto";
  enterBox.textContent = label;
  enterBox.classList.add("show");
  setEnterHint(label);
  playEnterScan();
  startScanLoop();
}
function setLoadingStatus(t){ dynamicText.textContent = t; }
function markReady(){
  if (readyToEnter) return;
  readyToEnter = true;
  showEnter("ENTER");
}

const SAFETY_TIMEOUT_MS = 9000;
let safetyTimeout = setTimeout(() => {
  if (!readyToEnter) {
    setLoadingStatus("SIGNAL DEGRADED // MANUAL START ENABLED");
    markReady();
  }
}, SAFETY_TIMEOUT_MS);

setTimeout(() => {
  if (!enterBox.classList.contains("show")) {
    setLoadingStatus("AWAITING STREAM // MANUAL START ENABLED");
    showEnter("ENTER");
  }
}, 2500);

video.addEventListener("loadeddata", markReady, { once:true });
video.addEventListener("canplay", markReady, { once:true });

function onVideoError(){
  clearTimeout(safetyTimeout);
  spinner.style.display = "none";
  setLoadingStatus("ERROR // DATA CORRUPTED // TAP TO RETRY");
  showEnter("RETRY");
}
video.addEventListener("error", onVideoError);
videoBlur.addEventListener("error", onVideoError);

/* ===== SYNC BLUR ===== */
video.addEventListener("play", () => { videoBlur.play().catch(()=>{}); });
video.addEventListener("pause", () => { try{ videoBlur.pause(); }catch(e){} });

/* ✅ VISIBILITY */
document.addEventListener("visibilitychange", () => {
  if (document.hidden) {
    try{ video.pause(); }catch(e){}
    try{ videoBlur.pause(); }catch(e){}
    try{ ambience.pause(); }catch(e){}
    return;
  }
  if (!hasEntered) {
    hardStopMediaIfNotEntered();
    return;
  }
  video.play().catch(()=>{});
  videoBlur.play().catch(()=>{});
  if (ambOn) ambience.play().catch(()=>{});
});

/* ===== VOLUME UI ===== */
video.volume = 0.7;
volSlider.value = String(video.volume);

function updateVolumeUI(){
  const pct = Math.round(Number(video.volume) * 100);
  volReadout.textContent = pct + "%";
  volumeHUD.style.setProperty("--bars-w", Math.max(6, pct) + "%");
  volumeHUD.style.setProperty("--bars-a", String(0.25 + (pct/100) * 0.55));
  volState.style.display = (pct === 0) ? "inline-block" : "none";
  ambience.volume = Math.min(0.35, Math.max(0.02, Number(video.volume) * 0.25));
}
volSlider.addEventListener("input", () => {
  video.volume = Number(volSlider.value);
  updateVolumeUI();
});
updateVolumeUI();

volIconBtn.addEventListener("click", (e) => {
  e.stopPropagation();
  volumeHUD.classList.toggle("open");
});
document.addEventListener("click", () => volumeHUD.classList.remove("open"));

/* ===== TECH HUD DYNAMIC ===== */
function pad2(n){ return String(n).padStart(2,"0"); }
function tickTech(){
  const d = new Date();
  sysClock.textContent = `${pad2(d.getHours())}:${pad2(d.getMinutes())}:${pad2(d.getSeconds())}`;
  const r = Math.random();
  sysStream.textContent = video.readyState >= 3 ? "STABLE" : (video.readyState ? "BUFFERING" : "OFFLINE");
  sysNeural.textContent = r > 0.92 ? "ANOMALIA DETECTADA" : (r > 0.75 ? "SINCRONIZANDO" : "CALIBRADO");
}
setInterval(tickTech, 900);
tickTech();

function rndCoord(){
  const a = (Math.random()*180 - 90).toFixed(4);
  const b = (Math.random()*360 - 180).toFixed(4);
  coordA.textContent = `COORD: ${a} / ${b}`;
  coordB.textContent = `NODE: Σ-${Math.floor(1+Math.random()*99).toString().padStart(2,"0")} // LINK: ${Math.random()>.15?"STABLE":"DEGRADED"}`;
}
setInterval(rndCoord, 2200);
rndCoord();

/* ===== FULLSCREEN ===== */
async function toggleFullscreen(){
  try{
    if (!document.fullscreenElement) await document.documentElement.requestFullscreen();
    else await document.exitFullscreen();
  } catch(e){}
}
btnFS.addEventListener("click", toggleFullscreen);

/* ===== GLITCH ===== */
function triggerGlitch(){
  document.body.classList.remove("glitch-on");
  void document.body.offsetWidth;
  document.body.classList.add("glitch-on");
  setTimeout(()=>document.body.classList.remove("glitch-on"), 700);
}

/* ===== Sub-layer glitch event ===== */
let subglitchArmed = false;
let subglitchTimer = null;
function triggerSubglitch(){
  if (!subglitchArmed) return;
  document.body.classList.add("subglitch");
  const dur = 220 + Math.random()*220;
  setTimeout(()=>document.body.classList.remove("subglitch"), dur);
}
function scheduleSubglitch(){
  if (!subglitchArmed) return;
  if (subglitchTimer) clearTimeout(subglitchTimer);
  const next = 60000 + Math.random()*60000;
  subglitchTimer = setTimeout(() => {
    triggerSubglitch();
    scheduleSubglitch();
  }, next);
}

/* ===== Audio Reactor (terminal presence) ===== */
const AudioFX = {
  ctx: null, master: null,
  droneGain: null, lfo: null, lfoGain: null,
  armed: false, lastTap: 0
};
function ensureAudio(){
  if (AudioFX.ctx) return true;
  try{
    const Ctx = window.AudioContext || window.webkitAudioContext;
    if (!Ctx) return false;
    AudioFX.ctx = new Ctx();
    AudioFX.master = AudioFX.ctx.createGain();
    AudioFX.master.gain.value = 0.0;
    AudioFX.master.connect(AudioFX.ctx.destination);

    const o1 = AudioFX.ctx.createOscillator();
    const o2 = AudioFX.ctx.createOscillator();
    o1.type = "triangle"; o2.type = "sine";
    o1.frequency.value = 44;
    o2.frequency.value = 118;

    AudioFX.droneGain = AudioFX.ctx.createGain();
    AudioFX.droneGain.gain.value = 0.0;

    o1.connect(AudioFX.droneGain);
    o2.connect(AudioFX.droneGain);
    AudioFX.droneGain.connect(AudioFX.master);

    AudioFX.lfo = AudioFX.ctx.createOscillator();
    AudioFX.lfo.type = "sine";
    AudioFX.lfo.frequency.value = 2.2;
    AudioFX.lfoGain = AudioFX.ctx.createGain();
    AudioFX.lfoGain.gain.value = 0.0;
    AudioFX.lfo.connect(AudioFX.lfoGain);
    AudioFX.lfoGain.connect(AudioFX.droneGain.gain);

    o1.start();
    o2.start();
    AudioFX.lfo.start();

    return true;
  }catch(e){ return false; }
}
function armAudioOnce(){
  if (AudioFX.armed) return;
  if (!ensureAudio()) return;
  AudioFX.armed = true;
  try{ if (AudioFX.ctx.state === "suspended") AudioFX.ctx.resume().catch(()=>{}); }catch(e){}
}
function setTerminalAudioState(state){
  if (!AudioFX.armed || !AudioFX.master) return;
  const now = AudioFX.ctx.currentTime;
  const target = (state === "off") ? 0.0 : (state === "open" ? 0.045 : 0.065);
  const lfoAmt = (state === "typing") ? 0.018 : 0.0;

  AudioFX.master.gain.cancelScheduledValues(now);
  AudioFX.master.gain.setTargetAtTime(target, now, 0.06);

  AudioFX.lfoGain.gain.cancelScheduledValues(now);
  AudioFX.lfoGain.gain.setTargetAtTime(lfoAmt, now, 0.05);
}
function blip(freq=820, dur=0.055, gain=0.06){
  if (!AudioFX.armed || !AudioFX.ctx || !AudioFX.master) return;
  const now = AudioFX.ctx.currentTime;
  const o = AudioFX.ctx.createOscillator();
  const g = AudioFX.ctx.createGain();
  o.type = "square";
  o.frequency.setValueAtTime(freq, now);
  g.gain.setValueAtTime(0.0001, now);
  g.gain.exponentialRampToValueAtTime(gain, now + 0.012);
  g.gain.exponentialRampToValueAtTime(0.0001, now + dur);
  o.connect(g);
  g.connect(AudioFX.master);
  o.start(now);
  o.stop(now + dur + 0.02);
}

/* ===== Protocol ===== */
const PROTOCOL_ENABLED = true;
const Protocol = {
  started: false, timers: [], lastPhase: null,
  phases: [
    { name: "BOOT", directive: "MONITORING", whenMs: 0, subject: "ONLINE" },
    { name: "SUBJECT_LOCK", directive: "IDENTITY: IRRELEVANT", whenMs: 4200, subject: "LOCKED" },
    { name: "CALIBRATION", directive: "PAIN LIMIT: ADJUSTABLE", whenMs: 9800, subject: "RESPONSIVE" },
    { name: "ASCENSION", directive: "PROTOCOL: ACTIVE", whenMs: 16800, subject: "MATERIAL" }
  ]
};
function setProtocolHUD(phase){
  sysPhase.textContent = phase.name.replace("_", " ");
  sysDirective.textContent = phase.directive;
  sysSubject.textContent = phase.subject;
  stripPhase(phase.name);
}
function clearProtocolTimers(){
  for (const t of Protocol.timers) clearTimeout(t);
  Protocol.timers.length = 0;
}
function startAscensionProtocol(){
  if (!PROTOCOL_ENABLED) return;
  if (Protocol.started) return;
  Protocol.started = true;
  clearProtocolTimers();
  const first = Protocol.phases[0];
  setProtocolHUD(first);
  Protocol.lastPhase = first.name;
  for (let i = 1; i < Protocol.phases.length; i++){
    const ph = Protocol.phases[i];
    const timer = setTimeout(() => { setProtocolHUD(ph); }, ph.whenMs);
    Protocol.timers.push(timer);
  }
}

/* ===== Terminal helpers (restaurado) ===== */
let termRunToken = 0;
let termTyping = false;
let termInteractive = false;
let loreCompleted = false;

function terminalAppendDimLine(text){
  const div = document.createElement("div");
  div.className = "termLine dim";
  div.textContent = text;
  termLog.appendChild(div);
  termLog.scrollTop = termLog.scrollHeight;
}
function clearTerminal(){ termLog.innerHTML = ""; }
function sleep(ms){ return new Promise(r => setTimeout(r, ms)); }
function ensureAlive(token){ return token === termRunToken && terminal.classList.contains("show"); }

async function typeLine(text, cls="", speed=14, token=0){
  if (!ensureAlive(token)) return;
  const div = document.createElement("div");
  div.className = "termLine " + cls;
  termLog.appendChild(div);

  for (let i=0; i<text.length; i++){
    if (!ensureAlive(token)) return;
    div.textContent += text[i];

    const now = performance.now();
    if (now - AudioFX.lastTap > 26){
      AudioFX.lastTap = now;
      blip(720 + Math.random()*180, 0.03, 0.015);
    }

    await sleep(speed + Math.random()*14);
    termLog.scrollTop = termLog.scrollHeight;
  }
}
async function typeGlitchPhraseOnly(token){
  const base = "Changing language to...";
  const variants = [
    "Cambiando idioma a...",
    "Ändere Sprache zu...",
    "Changement de langue...",
    "Изменение языка...",
    "言語を変更中...",
    "Mudando idioma para..."
  ];
  if (!ensureAlive(token)) return;
  const line = document.createElement("div");
  line.className = "termLine dim";
  line.textContent = base;
  termLog.appendChild(line);
  termLog.scrollTop = termLog.scrollHeight;

  await sleep(130);
  for (let i=0; i<variants.length; i++){
    if (!ensureAlive(token)) return;
    line.textContent = variants[i];
    blip(980 + Math.random()*260, 0.03, 0.020);
    await sleep(70);
  }
  if (!ensureAlive(token)) return;
  line.textContent = base;
  await sleep(200);
}

function normalizeCmd(s){ return (s || "").trim().toLowerCase(); }
function setInputEnabled(on){
  termInput.disabled = !on;
  termHint.style.opacity = on ? ".55" : ".35";
  termInput.placeholder = on ? "Digite um comando (ex: help)" : "Sistema ocupado...";
}
function focusTerminalInput(){
  if (!terminal.classList.contains("show")) return;
  if (!termInteractive) return;
  termInput.focus({ preventScroll:true });
}
function printUserCmd(raw){ terminalAppendDimLine(`${termPrompt.textContent} ${raw}`); }

async function respond(textLines){
  const token = termRunToken;
  for (const ln of textLines){
    if (!ensureAlive(token)) return;
    await typeLine(ln, "", 7, token);
    await sleep(90);
  }
}
async function handleCommand(raw){
  const cmd = normalizeCmd(raw);
  if (!termInteractive || termTyping){
    terminalAppendDimLine("// INPUT IGNORED: BUSY");
    return;
  }
  if (!cmd) return;
  printUserCmd(raw);

  blip(520, 0.05, 0.030);

  if (cmd === "help" || cmd === "?" ){
    await respond([
      "Comandos disponíveis:",
      "- status",
      "- phase",
      "- consent",
      "- whoami",
      "- who are you",
      "- exit",
      "- clear"
    ]);
    return;
  }
  if (cmd === "clear" || cmd === "cls"){
    clearTerminal();
    terminalAppendDimLine("// LOG CLEARED // (a memória é seletiva)");
    return;
  }
  if (cmd === "status"){
    await respond([
      `SUBJECT: ${sysSubject.textContent}`,
      `STREAM: ${sysStream.textContent}`,
      `NEURAL: ${sysNeural.textContent}`,
      `ETHICS: DISABLED`,
      `PHASE: ${sysPhase.textContent} // ${sysDirective.textContent}`
    ]);
    return;
  }
  if (cmd === "phase" || cmd === "protocol"){
    await respond([
      `ASCENSION PROTOCOL // ${sysPhase.textContent}`,
      `DIRECTIVE // ${sysDirective.textContent}`,
      "Observação: você não é um operador. É material."
    ]);
    return;
  }
  if (cmd === "consent" || cmd === "assinar" || cmd === "consentimento"){
    await respond([
      "CONSENT FORM // OPEN",
      "SIGNATURE: ACCEPTED",
      "CONSENT: OVERRIDDEN",
      "Você chama isso de moral? Interessante."
    ]);
    return;
  }
  if (cmd === "whoami" || cmd === "quem sou eu"){
    await respond([
      "IDENTITY QUERY // DENIED",
      "Você não precisa de um nome para cumprir sua função."
    ]);
    return;
  }
  if (cmd === "who are you" || cmd === "whoareyou" || cmd === "quem é você" || cmd === "quem é vc"){
    await respond([
      "Eu sou o único adulto na sala.",
      "E você... é apenas um recurso."
    ]);
    return;
  }
  if (cmd === "exit" || cmd === "quit" || cmd === "sair"){
    await respond([
      "REQUEST: EXIT",
      "RESULT: DENIED",
      "Negado. Ainda não terminou."
    ]);
    return;
  }
  await respond([
    `UNKNOWN COMMAND: "${raw}"`,
    "Se você quer controle, está no lugar errado."
  ]);
}

termInput.addEventListener("keydown", async (e) => {
  if (e.key !== "Enter") return;
  const v = termInput.value;
  termInput.value = "";
  await handleCommand(v);
  focusTerminalInput();
});

async function showCommandsHintAuto(token){
  if (!ensureAlive(token)) return;
  await sleep(220);
  await typeLine(" ", "dim", 1, token);
  await typeLine("COMANDOS DISPONÍVEIS:", "dim", 9, token);
  await typeLine("- status", "dim", 9, token);
  await typeLine("- phase", "dim", 9, token);
  await typeLine("- consent", "dim", 9, token);
  await typeLine("- whoami", "dim", 9, token);
  await typeLine("- who are you", "dim", 9, token);
  await typeLine("- clear", "dim", 9, token);
  await typeLine("Dica: digite \"help\" para repetir.", "dim", 9, token);
}

const LORE_SPEED = { header: 9, lang: 9, main: 13, post: 9 };

async function runLoreSequence(){
  const token = ++termRunToken;
  loreCompleted = false;
  termTyping = true;
  termInteractive = false;
  setInputEnabled(false);
  clearTerminal();

  setTerminalAudioState("typing");

  await typeLine("TERMINAL DO LABORATÓRIO ONLINE", "dim", LORE_SPEED.header, token);
  await typeLine("HANDSHAKE: ACEITO // AUTORIZAÇÃO: Δ", "dim", LORE_SPEED.header, token);
  await typeLine("CANAL DE LOG: PRIVADO // OBSERVADORES: NENHUM", "dim", LORE_SPEED.header, token);
  await sleep(220);

  await typeGlitchPhraseOnly(token);

  const langs = ["English (US)","Deutsch (DE)","Français (FR)","Español (ES)","Русский (RU)","日本語 (JP)","中文 (CN)","Português (BR)"];
  for (let k = 0; k < langs.length; k++){
    await typeLine(`> ${langs[k]}`, "dim", LORE_SPEED.lang, token);
    await sleep(k === langs.length - 1 ? 280 : 85);
  }

  await typeLine("Idioma definido: Português (BR).", "dim", LORE_SPEED.header, token);
  await sleep(280);

  const lines = [
    { t: "…", cls:"dim", d: 360 },
    { t: "Então você encontrou a interface.", cls:"", d: 360 },
    { t: "Ótimo. Curiosidade é a única virtude que eu ainda tolero.", cls:"", d: 480 },
    { t: "Vamos deixar claro: consentimento é um conceito decorativo.", cls:"dim", d: 520 },
    { t: "Estado do sujeito: responsivo.", cls:"", d: 360 },
    { t: "Módulo de ética: desativado.", cls:"", d: 360 },
    { t: "Limite de dor: ajustável.", cls:"dim", d: 450 },
    { t: "Se estiver com medo, não desvie o olhar.", cls:"", d: 520 },
    { t: "Observar exige devoção.", cls:"dim", d: 450 },
    { t: "Prosseguindo com a calibração.", cls:"", d: 450 },
    { t: "— Il Dottore", cls:"dim", d: 450 },
  ];
  for (const L of lines){
    await typeLine(L.t, LORE_SPEED.main ? L.cls : L.cls, LORE_SPEED.main, token);
    await sleep(L.d);
  }
  if (!ensureAlive(token)) return;

  await typeLine(" ", "dim", 1, token);
  await typeLine(`ASCENSION PROTOCOL // ${sysPhase.textContent}`, "dim", LORE_SPEED.post, token);
  await typeLine(`DIRECTIVE // ${sysDirective.textContent}`, "dim", LORE_SPEED.post, token);
  await typeLine("Você não é um convidado. É material.", "dim", LORE_SPEED.post, token);

  await showCommandsHintAuto(token);

  const cursor = document.createElement("div");
  cursor.className = "termLine";
  cursor.innerHTML = `<span class="cursor" aria-hidden="true">█</span>`;
  termLog.appendChild(cursor);
  termLog.scrollTop = termLog.scrollHeight;

  termTyping = false;
  termInteractive = true;
  loreCompleted = true;
  setInputEnabled(true);
  focusTerminalInput();

  setTerminalAudioState("open");
  blip(440, 0.07, 0.040);

  pulseStrip("TERMINAL:ONLINE", "INPUT:ARMED", `PHASE:${sysPhase.textContent}`);
  ss2.classList.remove("faint"); ss3.classList.remove("faint");
}

/* ===== Terminal open/close ===== */
function closeGames(){ if (games.classList.contains("show")){ games.classList.remove("show"); games.setAttribute("aria-hidden","true"); } }
function openTerminal(){
  closeCatalog(); closeChannels(); closeAdmin(); closeRoutes(); closeGames();

  terminal.classList.add("show");
  terminal.setAttribute("aria-hidden","false");

  armAudioOnce();
  blip(860, 0.08, 0.040);

  pulseStrip("TERMINAL:OPEN", "CHANNEL:PRIVATE", "TRACE:ACTIVE");
  ss2.classList.remove("faint"); ss3.classList.remove("faint");

  if (loreCompleted && !termTyping){
    termInteractive = true;
    setInputEnabled(true);
    focusTerminalInput();
    setTerminalAudioState("open");
    return;
  }
  runLoreSequence().catch(()=>{});
}
function closeTerminal(){
  const wasTyping = termTyping;
  terminal.classList.remove("show");
  terminal.setAttribute("aria-hidden","true");

  if (wasTyping){
    termRunToken++;
    termTyping = false;
    termInteractive = false;
    loreCompleted = false;
    setInputEnabled(false);
  } else {
    termInteractive = false;
    setInputEnabled(false);
  }

  setTerminalAudioState("off");
  pulseStrip("TERMINAL:CLOSED", "FEED:STANDBY", "TRACE:—");
}

btnTerm.addEventListener("click", (e) => {
  e.stopPropagation();
  if (terminal.classList.contains("show")) closeTerminal();
  else openTerminal();
});

/* ===== Routes node (V5) ===== */
function openRoutes(){
  closeTerminal(); closeCatalog(); closeAdmin(); closeGames();
  routesNode.classList.add("show");
  routesNode.setAttribute("aria-hidden","false");
  armAudioOnce();
  blip(720, 0.06, 0.022);
  pulseStrip("ROUTES:OPEN", "NODE:ACTIVE", "TRACE:LINK");
  ss2.classList.remove("faint"); ss3.classList.remove("faint");
}
function closeRoutes(){
  if (!routesNode.classList.contains("show")) return;
  routesNode.classList.remove("show");
  routesNode.setAttribute("aria-hidden","true");
  pulseStrip("ROUTES:CLOSED", "FEED:STANDBY", "TRACE:—");
}
function toggleRoutes(){
  if (routesNode.classList.contains("show")) closeRoutes();
  else openRoutes();
}

btnLinks.addEventListener("click", (e) => {
  e.stopPropagation();
  toggleRoutes();
});
routesNode.addEventListener("click", (e) => e.stopPropagation());
document.addEventListener("click", () => closeRoutes());

/* ===== Channels overlay (Redes sociais) ===== */
function openChannels(){
  closeTerminal(); closeCatalog(); closeAdmin(); closeRoutes(); closeGames();
  channels.classList.add("show");
  channels.setAttribute("aria-hidden","false");
  armAudioOnce();
  blip(720, 0.07, 0.030);
  pulseStrip("SOCIAL:OPEN", "OUTBOUND:READY", "TRACE:LINK");
  ss2.classList.remove("faint"); ss3.classList.remove("faint");
}
function closeChannels(){
  if (!channels.classList.contains("show")) return;
  channels.classList.remove("show");
  channels.setAttribute("aria-hidden","true");
  pulseStrip("SOCIAL:CLOSED", "FEED:STANDBY", "TRACE:—");
}
channels.addEventListener("click", (e) => { if (e.target === channels) closeChannels(); });

/* ===== Games overlay (novo) ===== */
function openGames(){
  closeTerminal(); closeCatalog(); closeChannels(); closeAdmin(); closeRoutes();
  games.classList.add("show");
  games.setAttribute("aria-hidden","false");
  armAudioOnce();
  blip(740, 0.07, 0.030);
  pulseStrip("GAMES:OPEN", "PANEL:GRAPHITE", "TRACE:ORANGE");
  ss2.classList.remove("faint"); ss3.classList.remove("faint");
}
games.addEventListener("click", (e) => { if (e.target === games) closeGames(); });
gmCloseBtn.addEventListener("click", () => closeGames());

/* Routes actions */
rSocial.addEventListener("click", () => openChannels());
rGames.addEventListener("click", () => { closeRoutes(); openGames(); });

[rArchive, rTx].forEach((btn, i) => {
  btn.addEventListener("click", () => {
    closeRoutes();
    armAudioOnce();
    blip(610, 0.06, 0.018);
    const name = i === 0 ? "ARCHIVE" : "TRANSMISSION";
    pulseStrip(`ROUTE:${name}`, "STATUS:PENDING", "TRACE:—");
    ss2.classList.remove("faint"); ss3.classList.remove("faint");
  });
});

/* ===== Catalog ===== */
const CATALOG_ITEMS = [
  { ref:"Σ-01 / VIVISECTION", status:"ARCHIVED", title:"PROJETO VITRINE // ÓRGÃOS EM LOOP", desc:"Exposição didática: manter o sujeito vivo o suficiente para assistir a própria anatomia 'funcionando'. Uma aula. Para ele, um castigo.", img:"https://files.catbox.moe/sc2vn9" },
  { ref:"Σ-07 / TRANSFER", status:"ACTIVE", title:"PROTOCOLO EIDOLON // IDENTIDADE REVOGADA", desc:"Separar a pessoa do nome. O nome do medo. Remover o resto. O que sobra obedece melhor.", img:"https://files.catbox.moe/z5b43n.jpg" },
  { ref:"Δ-12 / NEURAL", status:"SEALED", title:"CÓRTEX-Δ // DOR COMO TELEMETRIA", desc:"Dor não é punição. É um sensor. Você chama de crueldade porque não entende instrumentação.", img:"https://files.catbox.moe/aon2r8.webp" },
  { ref:"K-03 / SYNTH", status:"ARCHIVED", title:"GEL-SDS // PUREZA ABSOLUTA", desc:"Separar, quantificar, descartar. O destino de qualquer coisa que não alcança o padrão. Incluindo você.", img:"https://files.catbox.moe/a13jar.jpg" }
];

function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, (m) => ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[m]));
}
function currentFilter(){
  return { ARCHIVED: !!fArchived.checked, ACTIVE: !!fActive.checked, SEALED: !!fSealed.checked };
}
function syncFilterUI(){
  fArchivedWrap.classList.toggle("off", !fArchived.checked);
  fActiveWrap.classList.toggle("off", !fActive.checked);
  fSealedWrap.classList.toggle("off", !fSealed.checked);
}
function renderCatalog(){
  const filt = currentFilter();
  syncFilterUI();

  catGrid.innerHTML = "";
  for (const it of CATALOG_ITEMS){
    if (!filt[it.status]) continue;

    const card = document.createElement("div");
    card.className = "catCard";
    card.innerHTML = `
      <div class="catThumb">
        <img src="${escapeHtml(it.img)}" alt="" loading="lazy" decoding="async" referrerpolicy="no-referrer" crossorigin="anonymous" />
        <div class="catStamp">${escapeHtml(it.ref)}</div>
      </div>
      <div class="catContent">
        <div class="catTitle">${escapeHtml(it.title)}</div>
        <div class="catDesc">${escapeHtml(it.desc)}</div>
        <div class="catMeta">
          <div class="catBadge"><span class="catDot"></span><span>${escapeHtml(it.ref)}</span></div>
          <div class="catRight">${escapeHtml(it.status)}</div>
        </div>
      </div>
    `;
    const thumb = card.querySelector(".catThumb");
    const img = card.querySelector("img");
    img.addEventListener("error", () => {
      try{ img.style.display = "none"; }catch(e){}
      thumb.classList.add("noimg");
    }, { once:true });

    catGrid.appendChild(card);
  }
}
renderCatalog();

[fArchived, fActive, fSealed].forEach(el => {
  el.addEventListener("change", () => {
    renderCatalog();
    pulseStrip("CATALOG:FILTER", "INDEX:APPLIED", "TRACE:UPDATED");
    ss2.classList.remove("faint"); ss3.classList.remove("faint");
    blip(610, 0.06, 0.018);
  });
});

function openCatalog(){
  if (terminal.classList.contains("show")) closeTerminal();
  closeRoutes(); closeChannels(); closeAdmin(); closeGames();

  catalog.classList.add("show");
  catalog.setAttribute("aria-hidden","false");
  armAudioOnce();
  blip(640, 0.07, 0.032);

  pulseStrip("CATALOG:OPEN", "INDEX:Σ", "TRACE:ARCHIVE");
  ss2.classList.remove("faint"); ss3.classList.remove("faint");
}
function closeCatalog(){
  if (!catalog.classList.contains("show")) return;
  catalog.classList.remove("show");
  catalog.setAttribute("aria-hidden","true");
  pulseStrip("CATALOG:CLOSED", "FEED:STANDBY", "TRACE:—");
}
btnCat.addEventListener("click", (e) => {
  e.stopPropagation();
  if (catalog.classList.contains("show")) closeCatalog();
  else openCatalog();
});
catalog.addEventListener("click", (e) => { if (e.target === catalog) closeCatalog(); });

/* ===== Admin metrics (local) ===== */
const LS = { views: "dli_views_v5", device: "dli_device_v5", last: "dli_admin_last_v5" };
function nowStamp(){
  const d = new Date();
  const yyyy = d.getFullYear();
  const mm = String(d.getMonth()+1).padStart(2,"0");
  const dd = String(d.getDate()).padStart(2,"0");
  const hh = String(d.getHours()).padStart(2,"0");
  const mi = String(d.getMinutes()).padStart(2,"0");
  const ss = String(d.getSeconds()).padStart(2,"0");
  return `${yyyy}-${mm}-${dd}\n${hh}:${mi}:${ss}`;
}
function getViews(){ return Number(localStorage.getItem(LS.views) || "0"); }
function setViews(n){ localStorage.setItem(LS.views, String(n)); }
function ensureDevice(){
  let id = localStorage.getItem(LS.device);
  if (!id){
    id = "DEV-" + Math.random().toString(16).slice(2,10).toUpperCase();
    localStorage.setItem(LS.device, id);
  }
  return id;
}
function getLast(){ return localStorage.getItem(LS.last) || "—"; }
function setLast(v){ localStorage.setItem(LS.last, v); }

function refreshAdminUI(){
  mViews.textContent = String(getViews());
  mUnique.textContent = localStorage.getItem(LS.device) ? "1" : "0";
  mLast.textContent = getLast();
}

let adminAuthed = false;
let adminTransitionTimer = null;

function setAdminStatus(text, mode){
  adminStatus.classList.remove("ok","bad");
  adminStatus.textContent = text;
  if (mode === "ok") adminStatus.classList.add("ok");
  if (mode === "bad") adminStatus.classList.add("bad");
}

function doNameGlitch(){
  const span = adminStatus.querySelector(".glitchName");
  if (!span) return;
  span.classList.remove("on");
  void span.offsetWidth;
  span.classList.add("on");
  setTimeout(()=>span.classList.remove("on"), 650);
}

function setAdminModeDash(on){
  if (on) admin.classList.add("dash");
  else admin.classList.remove("dash");
}

function openAdmin(){
  closeTerminal(); closeCatalog(); closeChannels(); closeRoutes(); closeGames();
  admin.classList.add("show");
  admin.setAttribute("aria-hidden","false");

  setAdminModeDash(false);
  adminAuthed = false;
  if (adminTransitionTimer) { clearTimeout(adminTransitionTimer); adminTransitionTimer = null; }

  adminPass.value = "";
  setAdminStatus("Aguardando autenticação…");
  adminPass.focus({preventScroll:true});
}
function closeAdmin(){
  if (!admin.classList.contains("show")) return;
  admin.classList.remove("show");
  admin.setAttribute("aria-hidden","true");
  if (adminTransitionTimer) { clearTimeout(adminTransitionTimer); adminTransitionTimer = null; }
}

btnAdmin.addEventListener("click", (e) => {
  e.stopPropagation();
  if (admin.classList.contains("show")) closeAdmin();
  else openAdmin();
});
admin.addEventListener("click", (e) => { if (e.target === admin) closeAdmin(); });

function tryAuth(){
  const pass = (adminPass.value || "").trim();
  if (pass !== "Projeto26"){
    adminAuthed = false;
    if (adminTransitionTimer) { clearTimeout(adminTransitionTimer); adminTransitionTimer = null; }
    setAdminStatus("Senha incorreta.", "bad");
    blip(220, 0.06, 0.030);
    return;
  }

  adminAuthed = true;
  ensureDevice();
  setLast(nowStamp());
  refreshAdminUI();

  adminStatus.innerHTML = `Bem-vindo ao Painel, <span class="glitchName">Dottore</span>`;
  adminStatus.classList.remove("bad");
  adminStatus.classList.add("ok");
  doNameGlitch();
  blip(980, 0.07, 0.040);

  if (adminTransitionTimer) clearTimeout(adminTransitionTimer);
  adminTransitionTimer = setTimeout(() => {
    setAdminModeDash(true);
    pulseStrip("ADMIN:DASH", "ACCESS:GRANTED", "TRACE:PRIVATE");
    ss2.classList.remove("faint"); ss3.classList.remove("faint");
  }, 3000);
}

adminAuth.addEventListener("click", tryAuth);
adminPass.addEventListener("keydown", (e) => { if (e.key === "Enter") tryAuth(); });

adminClear.addEventListener("click", () => {
  adminPass.value = "";
  adminPass.focus({preventScroll:true});
});

adminReset.addEventListener("click", () => {
  if (!admin.classList.contains("dash")) return;
  localStorage.removeItem(LS.views);
  localStorage.removeItem(LS.device);
  localStorage.removeItem(LS.last);
  ensureDevice();
  setLast(nowStamp());
  refreshAdminUI();
  pulseStrip("ADMIN:RESET", "METRICS:CLEARED", "TRACE:Δ");
  ss2.classList.remove("faint"); ss3.classList.remove("faint");
  blip(640, 0.06, 0.030);
});

adminLock.addEventListener("click", () => {
  setAdminModeDash(false);
  adminAuthed = false;
  if (adminTransitionTimer) { clearTimeout(adminTransitionTimer); adminTransitionTimer = null; }
  adminPass.value = "";
  setAdminStatus("Sessão bloqueada.");
  adminPass.focus({preventScroll:true});
  pulseStrip("ADMIN:LOCK", "ACCESS:REVOKED", "TRACE:—");
});

/* ===== Keyboard routing ===== */
document.addEventListener("keydown", (e) => {
  if (e.key === "Escape"){
    if (terminal.classList.contains("show")) { closeTerminal(); return; }
    if (catalog.classList.contains("show")) { closeCatalog(); return; }
    if (channels.classList.contains("show")) { closeChannels(); return; }
    if (admin.classList.contains("show")) { closeAdmin(); return; }
    if (routesNode.classList.contains("show")) { closeRoutes(); return; }
    if (games.classList.contains("show")) { closeGames(); return; }
  }

  const isToggleKey = (e.key === "`" || e.key.toLowerCase() === "t");
  if (isToggleKey){
    const a = document.activeElement;
    const typingInInput = (a === termInput || a === adminPass);
    if (typingInInput) return;
    if (!terminal.classList.contains("show")) openTerminal();
    else focusTerminalInput();
  }

  if (e.key.toLowerCase() === "c"){
    const a = document.activeElement;
    const isTypingField = a && (a.tagName === "INPUT" || a.tagName === "TEXTAREA" || a.isContentEditable);
    if (isTypingField) return;
    if (!catalog.classList.contains("show")) openCatalog();
    else closeCatalog();
  }
});

/* ===== HELPERS ===== */
function hideLoading(){
  loadingScreen.style.opacity = "0";
  setTimeout(() => loadingScreen.style.display = "none", 600);
  clearInterval(msgTimer);
  sysSubject.textContent = "ATIVO";
  stopScanLoop();
  document.body.classList.add("entered");
}
function waitForPlaying(el, timeoutMs=1200){
  return new Promise((resolve, reject) => {
    let done = false;
    const onPlay = () => { if(done) return; done=true; cleanup(); resolve(); };
    const onErr = () => { if(done) return; done=true; cleanup(); reject(new Error("play error")); };
    const t = setTimeout(() => { if(done) return; done=true; cleanup(); resolve(); }, timeoutMs);
    function cleanup(){
      clearTimeout(t);
      el.removeEventListener("playing", onPlay);
      el.removeEventListener("error", onErr);
    }
    el.addEventListener("playing", onPlay, { once:true });
    el.addEventListener("error", onErr, { once:true });
  });
}

/* ===== ENTER / RETRY ===== */
enterBox.onclick = async () => {
  enterBox.style.pointerEvents = "none";
  armAudioOnce();

  if (enterBox.textContent === "RETRY") {
    spinner.style.display = "";
    setLoadingStatus("RECALIBRANDO STREAM...");
    enterBox.classList.remove("show");
    enterHint.classList.remove("show");
    readyToEnter = false;

    try { video.load(); videoBlur.load(); ambience.load(); } catch(e){}

    clearTimeout(safetyTimeout);
    safetyTimeout = setTimeout(() => {
      if (!readyToEnter) {
        setLoadingStatus("SINAL DEGRADADO // INÍCIO MANUAL LIBERADO");
        markReady();
      }
    }, SAFETY_TIMEOUT_MS);

    setTimeout(() => enterBox.style.pointerEvents = "auto", 200);
    return;
  }

  try {
    video.muted = false;
    await video.play();
    await waitForPlaying(video, 1500);

    hasEntered = true;

    ensureDevice();
    setViews(getViews() + 1);

    videoBlur.play().catch(()=>{});
    if (ambOn) ambience.play().catch(()=>{});

    updateVolumeUI();
    triggerGlitch();
    hideLoading();

    startAscensionProtocol();
    blip(980, 0.08, 0.040);

    subglitchArmed = true;
    scheduleSubglitch();

    pulseStrip("SYSTEM:ONLINE", "STREAM:LOCKED", "TRACE:Δ");
    ss2.classList.remove("faint");
    ss3.classList.remove("faint");

  } catch (err) {
    spinner.style.display = "none";
    setLoadingStatus("REPRODUÇÃO BLOQUEADA // CLIQUE NOVAMENTE");
    showEnter("ENTER");
  } finally {
    if (loadingScreen.style.display !== "none") {
      enterBox.style.pointerEvents = "auto";
    }
  }
};

/* teclado ENTER dispara o botão ENTER (quando loading está ativo) */
document.addEventListener("keydown", (e) => {
  if (e.key !== "Enter") return;

  if (terminal.classList.contains("show")) return;
  if (admin.classList.contains("show")) return;

  const a = document.activeElement;
  const isTypingField = a && (a.tagName === "INPUT" || a.tagName === "TEXTAREA" || a.isContentEditable);
  if (isTypingField) return;

  const loadingVisible = loadingScreen.style.display !== "none" && getComputedStyle(loadingScreen).display !== "none";
  if (!loadingVisible) return;

  if (enterBox.classList.contains("show") && enterBox.style.pointerEvents !== "none") {
    enterBox.click();
  }
});

/* ===== Initial defaults ===== */
setProtocolHUD(Protocol.phases[0]);
pulseStrip("SYSTEM:BOOT", "FEED:IDLE", "TRACE:—");
refreshAdminUI();
</script>

</body>
</html>
