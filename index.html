<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dottore</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;}

body{
  background:black;
  overflow:hidden;
  font-family:'Orbitron', sans-serif;
  color:white;
}

/* BLUR FUNDO */
#videoBlur{
  position:fixed;
  inset:-20%;
  width:140%;
  height:140%;
  object-fit:cover;

  /* performance: blur é caro, mas a gente mantém e otimiza */
  filter: blur(var(--blur-amount, 90px)) brightness(.5) saturate(1.5);
  will-change: transform, filter;
  transform: translateZ(0);

  z-index:-5;
}

/* VIDEO PRINCIPAL */
#video{
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  object-fit:contain;
  z-index:-4;
}

/* SCANLINES */
.scanlines{
  position:fixed;
  inset:0;
  background:repeating-linear-gradient(
    to bottom,
    rgba(255,255,255,0.03),
    rgba(255,255,255,0.03) 1px,
    transparent 1px,
    transparent 3px
  );
  pointer-events:none;
  z-index:-1;
}

/* LOADING */
#loadingScreen{
  position:fixed;
  inset:0;
  background:radial-gradient(circle at center,#0a0f18,#000);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:10;
  transition:opacity .6s ease;
}

.loading-text{
  letter-spacing:6px;
  margin-bottom:20px;
  font-size:12px;
  opacity:.8;
  text-align:center;
  animation:flicker 2s infinite;
  max-width: 90vw;
}

@keyframes flicker{
  0%,100%{opacity:.8}
  50%{opacity:1}
}

.spinner{
  width:40px;
  height:40px;
  border:3px solid rgba(255,255,255,.1);
  border-top:3px solid #00d4ff;
  border-radius:50%;
  animation:spin 1s linear infinite;
}

@keyframes spin{
  to{ transform:rotate(360deg); }
}

/* ENTER */
#enterBox{
  margin-top:40px;
  padding:18px 70px;
  border-radius:10px;
  background:rgba(10,20,35,0.6);
  border:1px solid rgba(0,200,255,0.4);
  backdrop-filter:blur(25px);
  letter-spacing:8px;
  font-weight:600;
  font-size:14px;
  color:#cfefff;
  text-shadow:0 0 8px rgba(0,200,255,0.7);
  opacity:0;
  pointer-events:none;
  transition:.4s ease;
  cursor:pointer;
  user-select: none;
}

#enterBox.show{
  opacity:1;
  pointer-events:auto;
}

/* HUD */
.hud{
  position:fixed;
  bottom:20px;
  left:30px;
  font-size:10px;
  opacity:.4;
  letter-spacing:2px;
  animation:blink 4s infinite;
}

@keyframes blink{
  0%,100%{opacity:.4}
  50%{opacity:.1}
}

/* acessibilidade / UX: respeitar usuário que prefere menos animação */
@media (prefers-reduced-motion: reduce){
  .scanlines{ opacity: .35; }
  .spinner{ animation: none; }
}

/* blur mais leve em telas pequenas (performance) */
@media (max-width: 768px){
  :root{ --blur-amount: 55px; }
}
</style>
</head>

<body>

<video id="videoBlur" playsinline preload="auto" muted loop>
  <source src="https://files.catbox.moe/um6f2u.mp4" type="video/mp4">
</video>

<video id="video" playsinline preload="auto" loop>
  <source src="https://files.catbox.moe/um6f2u.mp4" type="video/mp4">
</video>

<div class="scanlines"></div>

<div id="loadingScreen">
  <div class="loading-text" id="dynamicText">INITIALIZING EXPERIMENT...</div>
  <div class="spinner" id="spinner"></div>
  <div id="enterBox">ENTER</div>
</div>

<div class="hud">
  NEURAL LINK ESTABLISHED // SUBJECT ONLINE
</div>

<script>
const video = document.getElementById("video");
const videoBlur = document.getElementById("videoBlur");
const enterBox = document.getElementById("enterBox");
const loadingScreen = document.getElementById("loadingScreen");
const dynamicText = document.getElementById("dynamicText");
const spinner = document.getElementById("spinner");

/* frases rotativas */
const messages = [
  "INITIALIZING EXPERIMENT...",
  "STABILIZING MEMORY FRAGMENTS...",
  "NEURAL PATHWAYS SYNCHRONIZED...",
  "ETHICS MODULE DISABLED...",
  "SUBJECT AWARENESS: IRRELEVANT",
  "PROCEEDING WITHOUT CONSENT..."
];

let msgIndex = 0;
const msgTimer = setInterval(() => {
  msgIndex = (msgIndex + 1) % messages.length;
  dynamicText.textContent = messages[msgIndex];
}, 2200);

/* ---- Estado / robustez ---- */
let readyToEnter = false;
let enterShown = false;

function showEnter(label = "ENTER") {
  if (enterShown) return;
  enterShown = true;
  enterBox.textContent = label;
  enterBox.classList.add("show");
}

function setLoadingStatus(text) {
  dynamicText.textContent = text;
}

/* ENTER só quando tiver vídeo “tocável”.
   loadeddata/canplay é um bom meio-termo (canplaythrough nem sempre dispara bem na vida real). */
function markReady() {
  if (readyToEnter) return;
  readyToEnter = true;
  showEnter("ENTER");
}

/* fallback anti-loop: se a rede estiver ruim, ainda libera ENTER (ou vira RETRY se der erro) */
const SAFETY_TIMEOUT_MS = 9000;
const safetyTimeout = setTimeout(() => {
  if (!readyToEnter) {
    setLoadingStatus("SIGNAL DEGRADED // MANUAL START ENABLED");
    markReady();
  }
}, SAFETY_TIMEOUT_MS);

/* Eventos de carregamento */
video.addEventListener("loadeddata", markReady, { once:true });
video.addEventListener("canplay", markReady, { once:true });

/* Se der erro, vira retry (e não fica infinito) */
function onVideoError() {
  clearTimeout(safetyTimeout);
  spinner.style.display = "none";
  setLoadingStatus("ERROR // DATA CORRUPTED // TAP TO RETRY");
  enterBox.textContent = "RETRY";
  enterBox.classList.add("show");
  enterBox.style.pointerEvents = "auto";
}
video.addEventListener("error", onVideoError);
videoBlur.addEventListener("error", onVideoError);

/* sincronizar blur (mantém tua lógica) */
video.addEventListener("play", () => { videoBlur.play().catch(()=>{}); });
video.addEventListener("pause", () => { try{ videoBlur.pause(); }catch(e){} });

/* pausar quando aba some (performance e estabilidade) */
document.addEventListener("visibilitychange", () => {
  if (document.hidden) {
    try { video.pause(); } catch(e){}
    try { videoBlur.pause(); } catch(e){}
  }
});

/* Clique ENTER / RETRY */
enterBox.onclick = async () => {
  // se foi erro, tenta recarregar
  if (enterBox.textContent === "RETRY") {
    spinner.style.display = "";
    setLoadingStatus("RECALIBRATING STREAM...");
    enterBox.classList.remove("show");
    enterShown = false;
    readyToEnter = false;

    // força reload do vídeo
    try {
      video.load();
      videoBlur.load();
    } catch(e) {}

    // reativa safety timeout
    clearTimeout(safetyTimeout);
    setTimeout(() => {
      if (!readyToEnter) {
        setLoadingStatus("SIGNAL DEGRADED // MANUAL START ENABLED");
        markReady();
      }
    }, SAFETY_TIMEOUT_MS);

    return;
  }

  try {
    // volume depois do play evita algumas tretas de política do navegador
    await Promise.all([
      video.play(),
      videoBlur.play()
    ]);

    video.volume = 0.7;

    loadingScreen.style.opacity = "0";
    setTimeout(() => loadingScreen.style.display = "none", 600);

    // se quiser, pode parar as mensagens quando entrar
    clearInterval(msgTimer);

  } catch (err) {
    // se o browser bloquear por qualquer motivo, não deixa o usuário preso
    spinner.style.display = "none";
    setLoadingStatus("PLAYBACK BLOCKED // CLICK AGAIN");
    showEnter("ENTER");
  }
};
</script>

</body>
</html>
