<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Shadow Fight 2 — Entry</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;800&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;background:#000}

:root{
  --ember: rgba(255,140,70,1);
  --goldA: #fff2de;
  --goldB: #d9a56a;
  --goldC: #a8642c;
}

/* ===== VIDEO ===== */
#mainVideo{
  position:fixed; inset:0;
  width:100%; height:100%;
  object-fit:cover;
  z-index:0;
  opacity:0;
  transition:opacity 900ms ease, filter 900ms ease;
  filter:contrast(1.05) saturate(0.95);
}
body.entered #mainVideo{
  opacity:1;
  /* blur leve no vídeo da edit (pra virar "fundo" do site) */
  filter:contrast(1.06) saturate(0.92) blur(3px) brightness(0.82);
}

/* quando o pergaminho abre, deixa o fundo ainda mais dark */
body.scrollOpen #mainVideo{
  filter:contrast(1.06) saturate(0.92) blur(6px) brightness(0.62);
}

/* ===== ENTRY ===== */
#entry{
  position:fixed; inset:0;
  z-index:10;
  cursor:pointer;
  background:#000;
}

/* Fundo blur */
.bgFill{
  position:absolute; inset:0;
  background:url("https://files.catbox.moe/5yp48z.png") center/cover no-repeat;
  filter:blur(28px) brightness(0.22) contrast(1.2);
  transform:scale(1.2);
  z-index:1;
}

/* ===== PARTÍCULAS CINZA / CINZAS ===== */
#ashCanvas{
  position:absolute; inset:0;
  z-index:2;
  pointer-events:none;
}

/* ===== PALCO ===== */
.stage{
  position:absolute; inset:0;
  display:grid;
  place-items:center;
  z-index:5;
}

.frameWrap{
  width:min(1000px,88vw);
  aspect-ratio:16/9;
  position:relative;
  border-radius:16px;
  overflow:hidden;
  box-shadow:
    0 0 0 1px rgba(255,170,90,0.1),
    0 40px 140px rgba(0,0,0,0.95);
  transition:transform 450ms ease;
}
#entry:hover .frameWrap{ transform:scale(1.01); }

.frame{
  position:absolute; inset:0;
  width:100%; height:100%;
  object-fit:cover;
  filter:contrast(1.12) brightness(0.82) saturate(0.9);
}

.softOverlay{
  position:absolute; inset:0;
  z-index:2;
  background:
    radial-gradient(circle at center, rgba(0,0,0,0.18), rgba(0,0,0,0.72)),
    linear-gradient(to bottom, rgba(0,0,0,0.28), transparent 40%, rgba(0,0,0,0.55));
  backdrop-filter: blur(2px);
}

/* GIF do golpe */
#strike{
  opacity:0;
  z-index:3;
  mix-blend-mode:screen;
  transition:opacity 200ms ease;
}
body.strikeOn #strike{opacity:0.95}

/* ===== ENTER UI ===== */
.introUI{
  position:absolute; inset:0;
  display:grid;
  place-items:center;
  text-align:center;
  z-index:4;
  pointer-events:none;
}

.title{
  font-family: "Cinzel", serif;
  font-weight:800;
  font-size: clamp(26px, 3.2vw, 44px);
  letter-spacing:7px;
  text-transform:uppercase;

  background: linear-gradient(
    to bottom,
    var(--goldA) 0%,
    #f0cfa2 18%,
    var(--goldB) 45%,
    var(--goldC) 68%,
    #f6d5a8 100%
  );
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;

  text-shadow:
    0 2px 0 #000,
    0 0 10px rgba(255,140,70,0.55),
    0 0 34px rgba(255,100,0,0.35);

  position:relative;
  animation:pulse 2.6s ease-in-out infinite;
}

.title::after{
  content:"";
  position:absolute;
  inset:-14px -42px;
  background:
    radial-gradient(circle at center,
      rgba(255,120,0,0.14),
      rgba(0,0,0,0.75));
  z-index:-2;
  filter:blur(18px);
  border-radius:60px;
  opacity:0.85;
}

.title::before{
  content:"";
  position:absolute;
  inset:-8px -58px;
  z-index:-1;
  background: linear-gradient(120deg,
    transparent 0%,
    rgba(255,255,255,0.10) 35%,
    rgba(255,255,255,0.22) 50%,
    rgba(255,255,255,0.10) 65%,
    transparent 100%);
  transform:translateX(-70%);
  filter:blur(8px);
  opacity:0.55;
  animation:shine 2.8s ease-in-out infinite;
}

@keyframes shine{
  0%,55%{ transform:translateX(-70%); opacity:0.0; }
  65%{ opacity:0.55; }
  100%{ transform:translateX(70%); opacity:0.0; }
}

.sub{
  margin-top:10px;
  font-size:10px;
  letter-spacing:5px;
  color:rgba(255,255,255,0.35);
  text-transform:uppercase;
  animation:blink 1.2s steps(2,end) infinite;
}

@keyframes pulse{
  0%,100%{transform:translateY(0);opacity:.88}
  50%{transform:translateY(-3px);opacity:1}
}
@keyframes blink{
  0%,49%{opacity:.18}
  50%,100%{opacity:.55}
}

/* fade enter */
body.strikeOn .introUI{ opacity:0; transition:opacity 300ms ease; }

/* entrada some */
body.entered #entry{
  opacity:0;
  pointer-events:none;
  transition:opacity 900ms ease;
}

/* ===== VOLUME (CANTO SUPERIOR ESQUERDO) — menor ===== */
#grimoire{
  position:fixed;
  left:14px;
  top:14px;
  z-index:60;
  user-select:none;
}

.grimoireBtn{
  width:46px; height:46px;
  border-radius:12px;
  border:1px solid rgba(255,170,90,0.18);
  background:
    radial-gradient(circle at 30% 30%, rgba(255,140,70,0.16), rgba(0,0,0,0.78)),
    linear-gradient(to bottom, rgba(255,255,255,0.05), rgba(0,0,0,0.55));
  box-shadow:
    0 14px 44px rgba(0,0,0,0.75),
    0 0 22px rgba(255,140,70,0.14),
    inset 0 0 14px rgba(255,140,70,0.10);
  display:grid;
  place-items:center;
  cursor:pointer;
  position:relative;
  overflow:hidden;
  transition:transform .2s ease;
}
.grimoireBtn:hover{ transform:scale(1.05); }

.grimoireIcon{ width:22px; height:22px; }
.grimoireIcon svg{ width:100%; height:100%; display:block; }

.panel{
  position:absolute;
  left:0;
  top:58px;
  width:210px;
  padding:10px;
  border-radius:12px;
  border:1px solid rgba(255,170,90,0.18);
  background:
    radial-gradient(circle at 20% 20%, rgba(255,140,70,0.10), rgba(0,0,0,0.86)),
    linear-gradient(to bottom, rgba(255,255,255,0.05), rgba(0,0,0,0.55));
  box-shadow:
    0 26px 110px rgba(0,0,0,0.86),
    inset 0 0 22px rgba(255,140,70,0.07);
  transform-origin: 0% 0%;
  transform: scale(0.92) translateY(8px);
  opacity:0;
  pointer-events:none;
  transition:opacity 180ms ease, transform 220ms ease;
}
#grimoire.open .panel{
  opacity:1;
  transform: scale(1) translateY(0);
  pointer-events:auto;
}

.row{ display:flex; align-items:center; gap:10px; }

.volValue{
  min-width:44px;
  text-align:right;
  font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  font-size:12px;
  color:rgba(255,255,255,0.55);
}

/* Slider custom */
#vol{
  -webkit-appearance:none;
  appearance:none;
  width:100%;
  height:10px;
  border-radius:99px;
  outline:none;
  background:
    linear-gradient(to right, rgba(255,140,70,0.9) var(--p,25%), rgba(255,255,255,0.10) var(--p,25%));
  border:1px solid rgba(255,170,90,0.16);
  box-shadow: inset 0 0 18px rgba(0,0,0,0.65);
}

#vol::-webkit-slider-thumb{
  -webkit-appearance:none;
  appearance:none;
  width:16px; height:16px;
  border-radius:50%;
  background: radial-gradient(circle at 30% 30%, #fff2de, #d9a56a 55%, #8a4a1f);
  border:1px solid rgba(0,0,0,0.55);
  box-shadow: 0 0 16px rgba(255,140,70,0.30);
  cursor:pointer;
}
#vol::-moz-range-thumb{
  width:16px; height:16px;
  border-radius:50%;
  background: radial-gradient(circle at 30% 30%, #fff2de, #d9a56a 55%, #8a4a1f);
  border:1px solid rgba(0,0,0,0.55);
  box-shadow: 0 0 16px rgba(255,140,70,0.30);
  cursor:pointer;
}

/* ===== BOTÃO DO PERGAMINHO ===== */
#scrollBtn{
  position:fixed;
  left:14px;
  top:68px;
  z-index:60;
  width:46px;height:46px;
  border-radius:12px;
  border:1px solid rgba(255,170,90,0.18);
  background:
    radial-gradient(circle at 30% 30%, rgba(255,140,70,0.12), rgba(0,0,0,0.80)),
    linear-gradient(to bottom, rgba(255,255,255,0.05), rgba(0,0,0,0.55));
  box-shadow:
    0 14px 44px rgba(0,0,0,0.75),
    0 0 22px rgba(255,140,70,0.12);
  cursor:pointer;
  display:grid;
  place-items:center;
  transition:transform .2s ease, opacity .2s ease;
  opacity:0;
  pointer-events:none;
}
body.entered #scrollBtn{
  opacity:1;
  pointer-events:auto;
}
#scrollBtn:hover{ transform:scale(1.05); }

#scrollBtn svg{ width:22px;height:22px; opacity:.9; }

/* ===== OVERLAY DO PERGAMINHO ===== */
#scrollOverlay{
  position:fixed; inset:0;
  z-index:80;
  display:none;
}
body.scrollOpen #scrollOverlay{ display:block; }

#scrollOverlay .dim{
  position:absolute; inset:0;
  background:rgba(0,0,0,0.55);
}

.scroll{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%) scale(.92);
  width:min(820px, 92vw);
  height:min(520px, 78vh);
  opacity:0;
  transition:opacity 220ms ease, transform 320ms cubic-bezier(.12,.92,.12,1);
  pointer-events:none;
}
body.scrollOpen .scroll{
  opacity:1;
  transform:translate(-50%,-50%) scale(1);
  pointer-events:auto;
}

/* Pergaminho “fake” via CSS (rasgado + textura) */
.scrollPaper{
  position:absolute; inset:0;
  border-radius:18px;
  background:
    radial-gradient(circle at 20% 15%, rgba(255,255,255,0.22), transparent 55%),
    radial-gradient(circle at 70% 85%, rgba(0,0,0,0.10), transparent 60%),
    linear-gradient(0deg, #d7c19a, #f0e2c3 22%, #e6d0a9 58%, #d0b488);
  box-shadow:
    0 40px 160px rgba(0,0,0,0.85),
    inset 0 0 0 1px rgba(0,0,0,0.18),
    inset 0 0 60px rgba(120,70,10,0.22);
  filter:contrast(1.02) saturate(0.92);
  overflow:hidden;
}

/* bordas rasgadas */
.scrollPaper:before{
  content:"";
  position:absolute; inset:-10px;
  background:
    radial-gradient(circle at 10% 10%, rgba(0,0,0,0.12), transparent 30%),
    radial-gradient(circle at 90% 20%, rgba(0,0,0,0.12), transparent 30%),
    radial-gradient(circle at 20% 90%, rgba(0,0,0,0.12), transparent 35%),
    radial-gradient(circle at 80% 85%, rgba(0,0,0,0.12), transparent 35%);
  pointer-events:none;
  mix-blend-mode:multiply;
  opacity:.75;
}

/* máscara “rasgada” usando clip-path (sem imagem) */
.scrollMask{
  position:absolute; inset:0;
  clip-path: polygon(
    2% 5%, 6% 2%, 12% 4%, 20% 2%, 28% 4%, 36% 2%, 44% 4%, 52% 2%, 60% 4%, 68% 2%, 76% 4%, 84% 2%, 92% 4%, 98% 8%,
    97% 18%, 99% 26%, 97% 34%, 99% 42%, 97% 50%, 99% 58%, 97% 66%, 99% 74%, 97% 82%, 98% 92%,
    92% 96%, 86% 98%, 78% 96%, 70% 98%, 62% 96%, 54% 98%, 46% 96%, 38% 98%, 30% 96%, 22% 98%, 14% 96%, 8% 98%, 3% 94%,
    2% 86%, 1% 78%, 3% 70%, 1% 62%, 3% 54%, 1% 46%, 3% 38%, 1% 30%, 3% 22%, 1% 14%
  );
}

/* conteúdo do pergaminho */
.scrollInner{
  position:absolute; inset:0;
  padding:26px 26px 18px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  color:rgba(25,15,5,0.88);
}

.scrollTop{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  margin-bottom:12px;
}

.scrollTitle{
  font-family:"Cinzel", serif;
  font-weight:800;
  letter-spacing:3px;
  text-transform:uppercase;
  font-size:14px;
  color:rgba(40,22,8,0.88);
  text-shadow:0 1px 0 rgba(255,255,255,0.35);
}

.scrollClose{
  border:1px solid rgba(0,0,0,0.20);
  background:rgba(0,0,0,0.08);
  color:rgba(30,18,8,0.85);
  border-radius:10px;
  padding:8px 10px;
  cursor:pointer;
  font-weight:700;
  letter-spacing:1px;
}

.scrollBody{
  height:calc(100% - 52px);
  overflow:auto;
  padding-right:10px;
  line-height:1.45;
  font-size:13px;
}

/* “cinza” no texto */
.scrollBody .who{
  font-weight:800;
  letter-spacing:1px;
}
.scrollBody .mestre{ color:#4b2c14; }
.scrollBody .shadow{ color:#1b1b1b; }
.scrollBody .titan{ color:#2b1a10; }

.typeLine{
  margin:0 0 10px 0;
  white-space:pre-wrap;
}

.cursor{
  display:inline-block;
  width:10px;
  height:14px;
  transform:translateY(2px);
  background:rgba(20,10,0,0.75);
  margin-left:4px;
  animation:cur 0.8s steps(1,end) infinite;
}
@keyframes cur{
  0%,49%{opacity:0}
  50%,100%{opacity:1}
}

.cmds{
  margin-top:14px;
  padding:10px 12px;
  border-radius:12px;
  background:rgba(0,0,0,0.08);
  border:1px solid rgba(0,0,0,0.16);
  display:none;
}
.cmds.show{ display:block; }
.cmds .cmdTitle{
  font-family:"Cinzel", serif;
  font-weight:800;
  letter-spacing:2px;
  text-transform:uppercase;
  font-size:12px;
  margin-bottom:8px;
}
.cmd{
  margin:6px 0;
  color:rgba(20,10,0,0.9);
}
.cmd kbd{
  font-family:inherit;
  font-weight:800;
  padding:2px 6px;
  border-radius:8px;
  border:1px solid rgba(0,0,0,0.22);
  background:rgba(255,255,255,0.22);
}

/* animação “abrindo” (desenrolar) */
body.scrollOpen .scrollPaper{
  animation:unroll 520ms cubic-bezier(.12,.92,.12,1) both;
}
@keyframes unroll{
  0%{ filter:blur(1px) contrast(1) saturate(.9); transform:scaleY(.70); }
  55%{ transform:scaleY(1.02); }
  100%{ filter:blur(0) contrast(1.02) saturate(.92); transform:scaleY(1); }
}

@media (prefers-reduced-motion: reduce){
  .title, .sub{ animation:none; }
  .title::before{ display:none; }
}
</style>
</head>

<body>

<!-- Vídeo de fundo do seu site (edit) -->
<video id="mainVideo"
  src="https://files.catbox.moe/klaol5.webm"
  playsinline preload="auto" loop></video>

<!-- Áudio separado -->
<audio id="bgAudio" src="https://files.catbox.moe/99fu05.m4a" preload="auto"></audio>

<!-- TELA DE ENTRADA -->
<section id="entry" tabindex="0" aria-label="Entrada Shadow Fight 2">

  <div class="bgFill"></div>
  <canvas id="ashCanvas"></canvas>

  <div class="stage">
    <div class="frameWrap">
      <img class="frame" src="https://files.catbox.moe/5yp48z.png" alt="Shadow Fight 2 Entry">
      <div class="softOverlay"></div>

      <!-- GIF do golpe (você pediu manter) -->
      <img id="strike" class="frame" src="https://files.catbox.moe/er48bx.gif" alt="Golpe">

      <div class="introUI">
        <div>
          <div class="title">ENTER</div>
          <div class="sub">clique para iniciar</div>
        </div>
      </div>
    </div>
  </div>

</section>

<!-- Botão/Slider de Volume -->
<div id="grimoire" aria-label="Controle de volume">
  <button class="grimoireBtn" id="grimBtn" aria-label="Abrir controle de volume">
    <span class="grimoireIcon" aria-hidden="true">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M4 10v4h4l5 4V6L8 10H4Z"
              fill="rgba(255,220,190,0.85)"/>
        <path d="M16 9c1 .8 1.5 1.8 1.5 3s-.5 2.2-1.5 3"
              stroke="rgba(255,140,70,0.85)"
              stroke-width="1.6"
              stroke-linecap="round"/>
        <path d="M18.5 7.5c1.6 1.5 2.5 3 2.5 4.5s-.9 3-2.5 4.5"
              stroke="rgba(255,140,70,0.55)"
              stroke-width="1.4"
              stroke-linecap="round"/>
      </svg>
    </span>
  </button>

  <div class="panel">
    <div class="row">
      <input id="vol" type="range" min="0" max="100" value="25" />
      <div class="volValue" id="volValue">25%</div>
    </div>
  </div>
</div>

<!-- Botão do Pergaminho -->
<button id="scrollBtn" aria-label="Abrir pergaminho (lore)">
  <!-- ícone de pergaminho simples -->
  <svg viewBox="0 0 24 24" fill="none">
    <path d="M7 5h10v12a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V5Z"
          stroke="rgba(255,220,190,0.9)" stroke-width="1.6" />
    <path d="M7 8h10" stroke="rgba(255,140,70,0.7)" stroke-width="1.4" stroke-linecap="round"/>
    <path d="M7 11h8" stroke="rgba(255,140,70,0.55)" stroke-width="1.4" stroke-linecap="round"/>
    <path d="M7 14h9" stroke="rgba(255,140,70,0.45)" stroke-width="1.4" stroke-linecap="round"/>
  </svg>
</button>

<!-- Overlay do Pergaminho / "Terminal" -->
<div id="scrollOverlay" aria-hidden="true">
  <div class="dim"></div>

  <div class="scroll" role="dialog" aria-label="Pergaminho">
    <div class="scrollMask">
      <div class="scrollPaper">
        <div class="scrollInner">
          <div class="scrollTop">
            <div class="scrollTitle">Pergaminho — Vozes nas Sombras</div>
            <button class="scrollClose" id="scrollClose">FECHAR</button>
          </div>

          <div class="scrollBody" id="scrollBody">
            <!-- linhas digitadas via JS -->
            <div class="typeLine" id="typeLine"></div>
            <span class="cursor" id="cursor"></span>

            <div class="cmds" id="cmds">
              <div class="cmdTitle">Comandos do Usuário</div>
              <div class="cmd"><kbd>1</kbd> Abrir HUB</div>
              <div class="cmd"><kbd>2</kbd> Abrir ARQUIVO</div>
              <div class="cmd"><kbd>3</kbd> Sobre a Lore</div>
              <div class="cmd"><kbd>ESC</kbd> Fechar Pergaminho</div>
              <div class="cmd" style="opacity:.75;margin-top:10px;">(Esses comandos você vai trocar depois pelas opções do seu site.)</div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>

<script>
const entry = document.getElementById("entry");
const mainVideo = document.getElementById("mainVideo");
const bgAudio = document.getElementById("bgAudio");

/* ===== VOLUME PADRÃO 25% ===== */
let currentVol = 0.25;
bgAudio.volume = currentVol;

/* ===== CINZAS ===== */
const canvas = document.getElementById("ashCanvas");
const ctx = canvas.getContext("2d");
let DPR=1, W=0, H=0;

function resize(){
  DPR = devicePixelRatio || 1;
  canvas.width = Math.floor(innerWidth * DPR);
  canvas.height = Math.floor(innerHeight * DPR);
  canvas.style.width = innerWidth + "px";
  canvas.style.height = innerHeight + "px";
  ctx.setTransform(DPR,0,0,DPR,0,0);
  W = innerWidth; H = innerHeight;
}
resize();
addEventListener("resize", resize);

const ash=[];
const ASH_N = 190;
for(let i=0;i<ASH_N;i++){
  ash.push({
    x:Math.random()*W,
    y:Math.random()*H,
    r:Math.random()*2.2+0.5,
    v:Math.random()*0.62+0.18,
    drift:(Math.random()-0.5)*0.55,
    tw:Math.random()*0.9+0.1
  });
}

function drawAsh(){
  ctx.clearRect(0,0,W,H);
  for(const p of ash){
    p.y -= p.v;
    p.x += p.drift;

    if(p.y < -12){ p.y = H + 12; p.x = Math.random()*W; }
    if(p.x < -12) p.x = W + 12;
    if(p.x > W + 12) p.x = -12;

    const a = 0.08 + p.tw*0.16;
    ctx.beginPath();
    ctx.fillStyle = `rgba(210,210,210,${a})`;
    ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
    ctx.fill();
  }
  requestAnimationFrame(drawAsh);
}
drawAsh();

/* ===== CLICK ENTER ===== */
let started=false;

async function start(){
  if(started) return;
  started=true;

  document.body.classList.add("strikeOn");

  // toca áudio no clique (gesto)
  try{
    bgAudio.currentTime = 0;
    bgAudio.volume = currentVol;
    await bgAudio.play();
  }catch(e){}

  // vídeo entra depois do impacto (mudo, áudio separado)
  setTimeout(async ()=>{
    try{
      mainVideo.muted = true;
      await mainVideo.play();
    }catch(e){}
    document.body.classList.add("entered");
  }, 1050);
}

entry.addEventListener("pointerdown", start);
entry.addEventListener("keydown", (e)=>{
  if(e.key==="Enter" || e.key===" "){ e.preventDefault(); start(); }
});

/* ===== CONTROLE DE VOLUME ===== */
const grimoire = document.getElementById("grimoire");
const grimBtn = document.getElementById("grimBtn");
const vol = document.getElementById("vol");
const volValue = document.getElementById("volValue");

function setSliderVisual(v){
  vol.style.setProperty("--p", `${v}%`);
  volValue.textContent = `${v}%`;
}
setSliderVisual(25);

grimBtn.addEventListener("click",(e)=>{
  e.stopPropagation();
  grimoire.classList.toggle("open");
});

document.addEventListener("click",(e)=>{
  if(!grimoire.contains(e.target)) grimoire.classList.remove("open");
});

vol.addEventListener("input", ()=>{
  const v = Number(vol.value);
  setSliderVisual(v);
  currentVol = v/100;
  bgAudio.volume = currentVol;
});

/* ===== PERGAMINHO / TERMINAL ===== */
const scrollBtn = document.getElementById("scrollBtn");
const scrollOverlay = document.getElementById("scrollOverlay");
const scrollClose = document.getElementById("scrollClose");
const typeLine = document.getElementById("typeLine");
const cursor = document.getElementById("cursor");
const cmds = document.getElementById("cmds");

let typing = false;
let typedOnce = false;

// Lore base (você vai trocar depois — deixei macabro e com personagens)
const loreLines = [
  `<span class="who mestre">MESTRE:</span> A arena está silenciosa... mas as sombras nunca dormem.`,
  `<span class="who shadow">SHADOW:</span> Eu sinto o vazio se abrindo. Algo me chama do outro lado.`,
  `<span class="who titan">TITAN:</span> Você acha que pode escapar? Eu já marquei seu destino.`,
  `<span class="who mestre">MESTRE:</span> Não responda ao medo. Use-o. Transforme-o em lâmina.`,
  `<span class="who shadow">SHADOW:</span> Então... eu entro. E se eu cair, que as sombras me devorem.`,
  `<span class="who titan">TITAN:</span> Venha. Eu quero ouvir seu silêncio gritar.`
];

function openScroll(){
  if(!document.body.classList.contains("entered")) return;
  document.body.classList.add("scrollOpen");
  scrollOverlay.setAttribute("aria-hidden","false");

  // começa digitar só 1 vez (depois abre direto com cmds)
  if(!typedOnce){
    startTyping();
  }else{
    cmds.classList.add("show");
    cursor.style.display = "none";
  }
}

function closeScroll(){
  document.body.classList.remove("scrollOpen");
  scrollOverlay.setAttribute("aria-hidden","true");
}

scrollBtn.addEventListener("click",(e)=>{
  e.stopPropagation();
  openScroll();
});
scrollClose.addEventListener("click", closeScroll);
scrollOverlay.addEventListener("click",(e)=>{
  if(e.target.classList.contains("dim")) closeScroll();
});

document.addEventListener("keydown",(e)=>{
  if(e.key === "Escape" && document.body.classList.contains("scrollOpen")){
    closeScroll();
  }
  if(e.key.toLowerCase() === "t" && document.body.classList.contains("entered")){
    // atalho pra abrir pergaminho
    openScroll();
  }
});

/* Digitação */
function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }

async function startTyping(){
  if(typing) return;
  typing = true;
  typedOnce = true;

  typeLine.innerHTML = "";
  cmds.classList.remove("show");
  cursor.style.display = "inline-block";

  for(let i=0; i<loreLines.length; i++){
    // escreve linha com efeito
    const plain = loreLines[i].replace(/<[^>]*>/g, "");
    // render final por HTML (pra manter cores por classe), mas digita como texto "fake"
    const holder = document.createElement("div");
    holder.className = "typeLine";
    typeLine.appendChild(holder);

    // digitação char a char (em texto)
    let acc = "";
    for(let c=0; c<plain.length; c++){
      acc += plain[c];
      holder.textContent = acc;
      await sleep(12 + Math.random()*18);
    }

    // depois substitui pelo HTML rico (cores de quem fala)
    holder.innerHTML = loreLines[i];

    await sleep(260 + Math.random()*240);
  }

  cursor.style.display = "none";
  cmds.classList.add("show");
  typing = false;
}

/* (Opcional) comandos do pergaminho - placeholder */
document.addEventListener("keydown",(e)=>{
  if(!document.body.classList.contains("scrollOpen")) return;
  if(e.key === "1"){ alert("HUB (placeholder)"); }
  if(e.key === "2"){ alert("ARQUIVO (placeholder)"); }
  if(e.key === "3"){ alert("LORE (placeholder)"); }
});
</script>

</body>
</html>
